if(!GLMAT_EPSILON){var GLMAT_EPSILON=0.000001}if(!GLMAT_ARRAY_TYPE){var GLMAT_ARRAY_TYPE=(typeof Float32Array!=="undefined")?Float32Array:Array}if(!GLMAT_RANDOM){var GLMAT_RANDOM=Math.random}var glMatrix={};glMatrix.setMatrixArrayType=function(a){GLMAT_ARRAY_TYPE=a};if(typeof(exports)!=="undefined"){exports.glMatrix=glMatrix}var degree=Math.PI/180;glMatrix.toRadian=function(b){return b*degree};var mat3={};mat3.create=function(){var a=new GLMAT_ARRAY_TYPE(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};mat3.fromMat4=function(c,b){c[0]=b[0];c[1]=b[1];c[2]=b[2];c[3]=b[4];c[4]=b[5];c[5]=b[6];c[6]=b[8];c[7]=b[9];c[8]=b[10];return c};mat3.clone=function(b){var c=new GLMAT_ARRAY_TYPE(9);c[0]=b[0];c[1]=b[1];c[2]=b[2];c[3]=b[3];c[4]=b[4];c[5]=b[5];c[6]=b[6];c[7]=b[7];c[8]=b[8];return c};mat3.copy=function(c,b){c[0]=b[0];c[1]=b[1];c[2]=b[2];c[3]=b[3];c[4]=b[4];c[5]=b[5];c[6]=b[6];c[7]=b[7];c[8]=b[8];return c};mat3.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};mat3.transpose=function(d,c){if(d===c){var f=c[1],e=c[2],b=c[5];d[1]=c[3];d[2]=c[6];d[3]=f;d[5]=c[7];d[6]=e;d[7]=b}else{d[0]=c[0];d[1]=c[3];d[2]=c[6];d[3]=c[1];d[4]=c[4];d[5]=c[7];d[6]=c[2];d[7]=c[5];d[8]=c[8]}return d};mat3.invert=function(f,m){var e=m[0],d=m[1],c=m[2],p=m[3],o=m[4],n=m[5],k=m[6],j=m[7],h=m[8],g=h*o-n*j,b=-h*p+n*k,l=j*p-o*k,i=e*g+d*b+c*l;if(!i){return null}i=1/i;f[0]=g*i;f[1]=(-h*d+c*j)*i;f[2]=(n*d-c*o)*i;f[3]=b*i;f[4]=(h*e-c*k)*i;f[5]=(-n*e+c*p)*i;f[6]=l*i;f[7]=(-j*e+d*k)*i;f[8]=(o*e-d*p)*i;return f};mat3.adjoint=function(e,i){var d=i[0],c=i[1],b=i[2],l=i[3],k=i[4],j=i[5],h=i[6],g=i[7],f=i[8];e[0]=(k*f-j*g);e[1]=(b*g-c*f);e[2]=(c*j-b*k);e[3]=(j*h-l*f);e[4]=(d*f-b*h);e[5]=(b*l-d*j);e[6]=(l*g-k*h);e[7]=(c*h-d*g);e[8]=(d*k-c*l);return e};mat3.determinant=function(h){var d=h[0],c=h[1],b=h[2],k=h[3],j=h[4],i=h[5],g=h[6],f=h[7],e=h[8];return d*(e*j-i*f)+c*(-e*k+i*g)+b*(f*k-j*g)};mat3.multiply=function(o,t,s){var w=t[0],v=t[1],u=t[2],h=t[3],g=t[4],f=t[5],n=t[6],m=t[7],l=t[8],k=s[0],j=s[1],i=s[2],r=s[3],q=s[4],p=s[5],e=s[6],d=s[7],c=s[8];o[0]=k*w+j*h+i*n;o[1]=k*v+j*g+i*m;o[2]=k*u+j*f+i*l;o[3]=r*w+q*h+p*n;o[4]=r*v+q*g+p*m;o[5]=r*u+q*f+p*l;o[6]=e*w+d*h+c*n;o[7]=e*v+d*g+c*m;o[8]=e*u+d*f+c*l;return o};mat3.mul=mat3.multiply;mat3.translate=function(e,k,m){var d=k[0],c=k[1],b=k[2],o=k[3],n=k[4],l=k[5],h=k[6],g=k[7],f=k[8],j=m[0],i=m[1];e[0]=d;e[1]=c;e[2]=b;e[3]=o;e[4]=n;e[5]=l;e[6]=j*d+i*o+h;e[7]=j*c+i*n+g;e[8]=j*b+i*l+f;return e};mat3.rotate=function(f,l,k){var e=l[0],d=l[1],b=l[2],o=l[3],n=l[4],m=l[5],i=l[6],h=l[7],g=l[8],p=Math.sin(k),j=Math.cos(k);f[0]=j*e+p*o;f[1]=j*d+p*n;f[2]=j*b+p*m;f[3]=j*o-p*e;f[4]=j*n-p*d;f[5]=j*m-p*b;f[6]=i;f[7]=h;f[8]=g;return f};mat3.scale=function(e,c,d){var b=d[0],f=d[1];e[0]=b*c[0];e[1]=b*c[1];e[2]=b*c[2];e[3]=f*c[3];e[4]=f*c[4];e[5]=f*c[5];e[6]=c[6];e[7]=c[7];e[8]=c[8];return e};mat3.fromMat2d=function(c,b){c[0]=b[0];c[1]=b[1];c[2]=0;c[3]=b[2];c[4]=b[3];c[5]=0;c[6]=b[4];c[7]=b[5];c[8]=1;return c};mat3.fromQuat=function(k,h){var e=h[0],d=h[1],c=h[2],f=h[3],l=e+e,a=d+d,g=c+c,b=e*l,j=d*l,i=d*a,s=c*l,r=c*a,o=c*g,p=f*l,n=f*a,m=f*g;k[0]=1-i-o;k[3]=j-m;k[6]=s+n;k[1]=j+m;k[4]=1-b-o;k[7]=r-p;k[2]=s-n;k[5]=r+p;k[8]=1-b-i;return k};mat3.normalFromMat4=function(u,z){var D=z[0],B=z[1],A=z[2],x=z[3],f=z[4],e=z[5],d=z[6],c=z[7],t=z[8],s=z[9],r=z[10],q=z[11],F=z[12],E=z[13],C=z[14],y=z[15],p=D*e-B*f,o=D*d-A*f,n=D*c-x*f,m=B*d-A*e,l=B*c-x*e,k=A*c-x*d,j=t*E-s*F,i=t*C-r*F,h=t*y-q*F,g=s*C-r*E,w=s*y-q*E,v=r*y-q*C,b=p*v-o*w+n*g+m*h-l*i+k*j;if(!b){return null}b=1/b;u[0]=(e*v-d*w+c*g)*b;u[1]=(d*h-f*v-c*i)*b;u[2]=(f*w-e*h+c*j)*b;u[3]=(A*w-B*v-x*g)*b;u[4]=(D*v-A*h+x*i)*b;u[5]=(B*h-D*w-x*j)*b;u[6]=(E*k-C*l+y*m)*b;u[7]=(C*n-F*k-y*o)*b;u[8]=(F*l-E*n+y*p)*b;return u};mat3.str=function(b){return"mat3("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+")"};mat3.frob=function(b){return(Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)+Math.pow(b[3],2)+Math.pow(b[4],2)+Math.pow(b[5],2)+Math.pow(b[6],2)+Math.pow(b[7],2)+Math.pow(b[8],2)))};if(typeof(exports)!=="undefined"){exports.mat3=mat3}var mat4={};mat4.create=function(){var a=new GLMAT_ARRAY_TYPE(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};mat4.clone=function(b){var c=new GLMAT_ARRAY_TYPE(16);c[0]=b[0];c[1]=b[1];c[2]=b[2];c[3]=b[3];c[4]=b[4];c[5]=b[5];c[6]=b[6];c[7]=b[7];c[8]=b[8];c[9]=b[9];c[10]=b[10];c[11]=b[11];c[12]=b[12];c[13]=b[13];c[14]=b[14];c[15]=b[15];return c};mat4.copy=function(c,b){c[0]=b[0];c[1]=b[1];c[2]=b[2];c[3]=b[3];c[4]=b[4];c[5]=b[5];c[6]=b[6];c[7]=b[7];c[8]=b[8];c[9]=b[9];c[10]=b[10];c[11]=b[11];c[12]=b[12];c[13]=b[13];c[14]=b[14];c[15]=b[15];return c};mat4.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};mat4.transpose=function(e,d){if(e===d){var i=d[1],g=d[2],f=d[3],b=d[6],h=d[7],c=d[11];e[1]=d[4];e[2]=d[8];e[3]=d[12];e[4]=i;e[6]=d[9];e[7]=d[13];e[8]=g;e[9]=b;e[11]=d[14];e[12]=f;e[13]=h;e[14]=c}else{e[0]=d[0];e[1]=d[4];e[2]=d[8];e[3]=d[12];e[4]=d[1];e[5]=d[5];e[6]=d[9];e[7]=d[13];e[8]=d[2];e[9]=d[6];e[10]=d[10];e[11]=d[14];e[12]=d[3];e[13]=d[7];e[14]=d[11];e[15]=d[15]}return e};mat4.invert=function(u,z){var D=z[0],B=z[1],A=z[2],x=z[3],f=z[4],e=z[5],d=z[6],c=z[7],t=z[8],s=z[9],r=z[10],q=z[11],F=z[12],E=z[13],C=z[14],y=z[15],p=D*e-B*f,o=D*d-A*f,n=D*c-x*f,m=B*d-A*e,l=B*c-x*e,k=A*c-x*d,j=t*E-s*F,i=t*C-r*F,h=t*y-q*F,g=s*C-r*E,w=s*y-q*E,v=r*y-q*C,b=p*v-o*w+n*g+m*h-l*i+k*j;if(!b){return null}b=1/b;u[0]=(e*v-d*w+c*g)*b;u[1]=(A*w-B*v-x*g)*b;u[2]=(E*k-C*l+y*m)*b;u[3]=(r*l-s*k-q*m)*b;u[4]=(d*h-f*v-c*i)*b;u[5]=(D*v-A*h+x*i)*b;u[6]=(C*n-F*k-y*o)*b;u[7]=(t*k-r*n+q*o)*b;u[8]=(f*w-e*h+c*j)*b;u[9]=(B*h-D*w-x*j)*b;u[10]=(F*l-E*n+y*p)*b;u[11]=(s*n-t*l-q*p)*b;u[12]=(e*i-f*g-d*j)*b;u[13]=(D*g-B*i+A*j)*b;u[14]=(E*o-F*m-C*p)*b;u[15]=(t*m-s*o+r*p)*b;return u};mat4.adjoint=function(j,m){var q=m[0],o=m[1],n=m[2],k=m[3],e=m[4],d=m[5],c=m[6],b=m[7],i=m[8],h=m[9],g=m[10],f=m[11],s=m[12],r=m[13],p=m[14],l=m[15];j[0]=(d*(g*l-f*p)-h*(c*l-b*p)+r*(c*f-b*g));j[1]=-(o*(g*l-f*p)-h*(n*l-k*p)+r*(n*f-k*g));j[2]=(o*(c*l-b*p)-d*(n*l-k*p)+r*(n*b-k*c));j[3]=-(o*(c*f-b*g)-d*(n*f-k*g)+h*(n*b-k*c));j[4]=-(e*(g*l-f*p)-i*(c*l-b*p)+s*(c*f-b*g));j[5]=(q*(g*l-f*p)-i*(n*l-k*p)+s*(n*f-k*g));j[6]=-(q*(c*l-b*p)-e*(n*l-k*p)+s*(n*b-k*c));j[7]=(q*(c*f-b*g)-e*(n*f-k*g)+i*(n*b-k*c));j[8]=(e*(h*l-f*r)-i*(d*l-b*r)+s*(d*f-b*h));j[9]=-(q*(h*l-f*r)-i*(o*l-k*r)+s*(o*f-k*h));j[10]=(q*(d*l-b*r)-e*(o*l-k*r)+s*(o*b-k*d));j[11]=-(q*(d*f-b*h)-e*(o*f-k*h)+i*(o*b-k*d));j[12]=-(e*(h*p-g*r)-i*(d*p-c*r)+s*(d*g-c*h));j[13]=(q*(h*p-g*r)-i*(o*p-n*r)+s*(o*g-n*h));j[14]=-(q*(d*p-c*r)-e*(o*p-n*r)+s*(o*c-n*d));j[15]=(q*(d*g-c*h)-e*(o*g-n*h)+i*(o*c-n*d));return j};mat4.determinant=function(w){var B=w[0],z=w[1],x=w[2],v=w[3],e=w[4],d=w[5],c=w[6],b=w[7],s=w[8],r=w[9],q=w[10],p=w[11],D=w[12],C=w[13],A=w[14],y=w[15],o=B*d-z*e,n=B*c-x*e,m=B*b-v*e,l=z*c-x*d,k=z*b-v*d,j=x*b-v*c,i=s*C-r*D,h=s*A-q*D,g=s*y-p*D,f=r*A-q*C,u=r*y-p*C,t=q*y-p*A;return o*t-n*u+m*f+l*g-k*h+j*i};mat4.multiply=function(o,s,p){var w=s[0],v=s[1],t=s[2],q=s[3],i=s[4],g=s[5],e=s[6],c=s[7],n=s[8],m=s[9],l=s[10],k=s[11],y=s[12],x=s[13],u=s[14],r=s[15];var j=p[0],h=p[1],f=p[2],d=p[3];o[0]=j*w+h*i+f*n+d*y;o[1]=j*v+h*g+f*m+d*x;o[2]=j*t+h*e+f*l+d*u;o[3]=j*q+h*c+f*k+d*r;j=p[4];h=p[5];f=p[6];d=p[7];o[4]=j*w+h*i+f*n+d*y;o[5]=j*v+h*g+f*m+d*x;o[6]=j*t+h*e+f*l+d*u;o[7]=j*q+h*c+f*k+d*r;j=p[8];h=p[9];f=p[10];d=p[11];o[8]=j*w+h*i+f*n+d*y;o[9]=j*v+h*g+f*m+d*x;o[10]=j*t+h*e+f*l+d*u;o[11]=j*q+h*c+f*k+d*r;j=p[12];h=p[13];f=p[14];d=p[15];o[12]=j*w+h*i+f*n+d*y;o[13]=j*v+h*g+f*m+d*x;o[14]=j*t+h*e+f*l+d*u;o[15]=j*q+h*c+f*k+d*r;return o};mat4.mul=mat4.multiply;mat4.translate=function(n,p,i){var h=i[0],g=i[1],f=i[2],s,r,q,o,e,d,c,b,m,l,k,j;if(p===n){n[12]=p[0]*h+p[4]*g+p[8]*f+p[12];n[13]=p[1]*h+p[5]*g+p[9]*f+p[13];n[14]=p[2]*h+p[6]*g+p[10]*f+p[14];n[15]=p[3]*h+p[7]*g+p[11]*f+p[15]}else{s=p[0];r=p[1];q=p[2];o=p[3];e=p[4];d=p[5];c=p[6];b=p[7];m=p[8];l=p[9];k=p[10];j=p[11];n[0]=s;n[1]=r;n[2]=q;n[3]=o;n[4]=e;n[5]=d;n[6]=c;n[7]=b;n[8]=m;n[9]=l;n[10]=k;n[11]=j;n[12]=s*h+e*g+m*f+p[12];n[13]=r*h+d*g+l*f+p[13];n[14]=q*h+c*g+k*f+p[14];n[15]=o*h+b*g+j*f+p[15]}return n};mat4.scale=function(e,c,d){var b=d[0],g=d[1],f=d[2];e[0]=c[0]*b;e[1]=c[1]*b;e[2]=c[2]*b;e[3]=c[3]*b;e[4]=c[4]*g;e[5]=c[5]*g;e[6]=c[6]*g;e[7]=c[7]*g;e[8]=c[8]*f;e[9]=c[9]*f;e[10]=c[10]*f;e[11]=c[11]*f;e[12]=c[12];e[13]=c[13];e[14]=c[14];e[15]=c[15];return e};mat4.rotate=function(B,I,K,b){var m=b[0],l=b[1],k=b[2],C=Math.sqrt(m*m+l*l+k*k),r,G,q,M,L,J,H,j,i,h,g,A,w,v,u,p,o,n,F,E,D,f,e,d;if(Math.abs(C)<GLMAT_EPSILON){return null}C=1/C;m*=C;l*=C;k*=C;r=Math.sin(K);G=Math.cos(K);q=1-G;M=I[0];L=I[1];J=I[2];H=I[3];j=I[4];i=I[5];h=I[6];g=I[7];A=I[8];w=I[9];v=I[10];u=I[11];p=m*m*q+G;o=l*m*q+k*r;n=k*m*q-l*r;F=m*l*q-k*r;E=l*l*q+G;D=k*l*q+m*r;f=m*k*q+l*r;e=l*k*q-m*r;d=k*k*q+G;B[0]=M*p+j*o+A*n;B[1]=L*p+i*o+w*n;B[2]=J*p+h*o+v*n;B[3]=H*p+g*o+u*n;B[4]=M*F+j*E+A*D;B[5]=L*F+i*E+w*D;B[6]=J*F+h*E+v*D;B[7]=H*F+g*E+u*D;B[8]=M*f+j*e+A*d;B[9]=L*f+i*e+w*d;B[10]=J*f+h*e+v*d;B[11]=H*f+g*e+u*d;if(I!==B){B[12]=I[12];B[13]=I[13];B[14]=I[14];B[15]=I[15]}return B};mat4.rotateX=function(b,j,i){var o=Math.sin(i),h=Math.cos(i),n=j[4],m=j[5],l=j[6],k=j[7],g=j[8],f=j[9],e=j[10],d=j[11];if(j!==b){b[0]=j[0];b[1]=j[1];b[2]=j[2];b[3]=j[3];b[12]=j[12];b[13]=j[13];b[14]=j[14];b[15]=j[15]}b[4]=n*h+g*o;b[5]=m*h+f*o;b[6]=l*h+e*o;b[7]=k*h+d*o;b[8]=g*h-n*o;b[9]=f*h-m*o;b[10]=e*h-l*o;b[11]=d*h-k*o;return b};mat4.rotateY=function(g,n,m){var o=Math.sin(m),l=Math.cos(m),f=n[0],e=n[1],d=n[2],b=n[3],k=n[8],j=n[9],i=n[10],h=n[11];if(n!==g){g[4]=n[4];g[5]=n[5];g[6]=n[6];g[7]=n[7];g[12]=n[12];g[13]=n[13];g[14]=n[14];g[15]=n[15]}g[0]=f*l-k*o;g[1]=e*l-j*o;g[2]=d*l-i*o;g[3]=b*l-h*o;g[8]=f*o+k*l;g[9]=e*o+j*l;g[10]=d*o+i*l;g[11]=b*o+h*l;return g};mat4.rotateZ=function(g,j,i){var o=Math.sin(i),h=Math.cos(i),f=j[0],e=j[1],d=j[2],b=j[3],n=j[4],m=j[5],l=j[6],k=j[7];if(j!==g){g[8]=j[8];g[9]=j[9];g[10]=j[10];g[11]=j[11];g[12]=j[12];g[13]=j[13];g[14]=j[14];g[15]=j[15]}g[0]=f*h+n*o;g[1]=e*h+m*o;g[2]=d*h+l*o;g[3]=b*h+k*o;g[4]=n*h-f*o;g[5]=m*h-e*o;g[6]=l*h-d*o;g[7]=k*h-b*o;return g};mat4.fromRotationTranslation=function(n,l,j){var g=l[0],f=l[1],e=l[2],h=l[3],o=g+g,a=f+f,i=e+e,d=g*o,c=g*a,b=g*i,m=f*a,k=f*i,s=e*i,t=h*o,r=h*a,p=h*i;n[0]=1-(m+s);n[1]=c+p;n[2]=b-r;n[3]=0;n[4]=c-p;n[5]=1-(d+s);n[6]=k+t;n[7]=0;n[8]=b+r;n[9]=k-t;n[10]=1-(d+m);n[11]=0;n[12]=j[0];n[13]=j[1];n[14]=j[2];n[15]=1;return n};mat4.fromQuat=function(k,h){var e=h[0],d=h[1],c=h[2],f=h[3],l=e+e,a=d+d,g=c+c,b=e*l,j=d*l,i=d*a,s=c*l,r=c*a,o=c*g,p=f*l,n=f*a,m=f*g;k[0]=1-i-o;k[1]=j+m;k[2]=s-n;k[3]=0;k[4]=j-m;k[5]=1-b-o;k[6]=r+p;k[7]=0;k[8]=s+n;k[9]=r-p;k[10]=1-b-i;k[11]=0;k[12]=0;k[13]=0;k[14]=0;k[15]=1;return k};mat4.frustum=function(e,b,j,a,i,g,f){var h=1/(j-b),d=1/(i-a),c=1/(g-f);e[0]=(g*2)*h;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=(g*2)*d;e[6]=0;e[7]=0;e[8]=(j+b)*h;e[9]=(i+a)*d;e[10]=(f+g)*c;e[11]=-1;e[12]=0;e[13]=0;e[14]=(f*g*2)*c;e[15]=0;return e};mat4.perspective=function(d,c,b,e,a){var h=1/Math.tan(c/2),g=1/(e-a);d[0]=h/b;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=h;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=(a+e)*g;d[11]=-1;d[12]=0;d[13]=0;d[14]=(2*a*e)*g;d[15]=0;return d};mat4.ortho=function(d,b,j,a,h,g,f){var e=1/(b-j),i=1/(a-h),c=1/(g-f);d[0]=-2*e;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=-2*i;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=2*c;d[11]=0;d[12]=(b+j)*e;d[13]=(h+a)*i;d[14]=(f+g)*c;d[15]=1;return d};mat4.lookAt=function(o,v,w,g){var u,t,r,c,b,a,j,i,h,p,s=v[0],q=v[1],n=v[2],f=g[0],e=g[1],d=g[2],m=w[0],l=w[1],k=w[2];if(Math.abs(s-m)<GLMAT_EPSILON&&Math.abs(q-l)<GLMAT_EPSILON&&Math.abs(n-k)<GLMAT_EPSILON){return mat4.identity(o)}j=s-m;i=q-l;h=n-k;p=1/Math.sqrt(j*j+i*i+h*h);j*=p;i*=p;h*=p;u=e*h-d*i;t=d*j-f*h;r=f*i-e*j;p=Math.sqrt(u*u+t*t+r*r);if(!p){u=0;t=0;r=0}else{p=1/p;u*=p;t*=p;r*=p}c=i*r-h*t;b=h*u-j*r;a=j*t-i*u;p=Math.sqrt(c*c+b*b+a*a);if(!p){c=0;b=0;a=0}else{p=1/p;c*=p;b*=p;a*=p}o[0]=u;o[1]=c;o[2]=j;o[3]=0;o[4]=t;o[5]=b;o[6]=i;o[7]=0;o[8]=r;o[9]=a;o[10]=h;o[11]=0;o[12]=-(u*s+t*q+r*n);o[13]=-(c*s+b*q+a*n);o[14]=-(j*s+i*q+h*n);o[15]=1;return o};mat4.str=function(b){return"mat4("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+", "+b[9]+", "+b[10]+", "+b[11]+", "+b[12]+", "+b[13]+", "+b[14]+", "+b[15]+")"};mat4.frob=function(b){return(Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)+Math.pow(b[3],2)+Math.pow(b[4],2)+Math.pow(b[5],2)+Math.pow(b[6],2)+Math.pow(b[7],2)+Math.pow(b[8],2)+Math.pow(b[9],2)+Math.pow(b[10],2)+Math.pow(b[11],2)+Math.pow(b[12],2)+Math.pow(b[13],2)+Math.pow(b[14],2)+Math.pow(b[15],2)))};if(typeof(exports)!=="undefined"){exports.mat4=mat4}function Vector2(a,b){this.x=a;this.y=b;__construct=function(){}();this.add=function(c){this.x+=c.x;this.y+=c.y;return this};this.subtract=function(c){this.x-=c.x;this.y-=c.y;return this};this.multiply=function(c){this.x*=c;this.y*=c;return this};this.zero=function(){this.x=0;this.y=0;return this}}Vector2.Multiply=function(d,c){return new Vector2(d.x*c.x,d.y*c.y)};Vector2.MultiplyByValue=function(d,c){return new Vector2(d.x*c,d.y*c)};Vector2.Subtract=function(d,c){return new Vector2(d.x-c.x,d.y-c.y)};Vector2.Equals=function(d,c){return(d.x==c.x&&d.y==c.y)};function Vector3(a,c,b){this.x=a;this.y=c;this.z=b;__construct=function(){}();this.add=function(d){this.x+=d.x;this.y+=d.y;this.z+=d.z;return this};this.subtract=function(d){this.x-=d.x;this.y-=d.y;this.z-=d.z;return this};this.multiply=function(d){this.x*=d;this.y*=d;this.z*=d;return this};this.zero=function(){this.x=0;this.y=0;this.z=0;return this}}Vector3.Multiply=function(d,c){return new Vector3(d.x*c.x,d.y*c.y,d.z*c.z)};Vector3.MultiplyByValue=function(d,c){return new Vector3(d.x*c,d.y*c,d.z*c)};Vector3.Subtract=function(d,c){return new Vector3(d.x-c.x,d.y-c.y,d.z-c.z)};Vector3.Equals=function(d,c){return(d.x==c.x&&d.y==c.y&&d.z==c.z)};function Rect(a,d,b,c){this.x=a;this.y=d;this.w=b;this.h=c;this.lt=new Vector2(a,d);this.lb=new Vector2(a,d+c);this.rt=new Vector2(a+b,d);this.rb=new Vector2(a+b,d+c)}var OMEGA=OMEGA||{};OMEGA.Utils=function(){this.instance=null};OMEGA.Utils.GetInstance=function(){if(this.instance==null){console.log("created.");this.instance=new OMEGA.Utils()}return this.instance};OMEGA.Utils.prototype.LoadScript=function(b,d){var c=document.getElementsByTagName("head")[0];var a=document.createElement("script");a.type="text/javascript";a.src=b;a.onreadystatechange=d;a.onload=d;c.appendChild(a)};OMEGA.Utils.prototype.LoadScripts=function(b,c){for(var a=0;a<b.length;a++){this.LoadScript(b[a],a<b.length-1?null:c)}};OMEGA.Utils.prototype.LoadImages=function(f,g){var b=[];var a=f.length;var d=function(){if(--a==0){g(b)}};for(var c=0;c<a;++c){var e=this.LoadImage(f[c],d);b.push(e)}};OMEGA.Utils.prototype.LoadImage=function(a,c){var b=new Image();b.onload=c;b.src=a;return b};OMEGA.Utils.prototype.LoadFile=function(a,c){var b=new XMLHttpRequest()||new ActiveXObject("MSXML2.XMLHTTP");b.open("GET",a,false);b.onreadystatechange=c;b.send(null)};OMEGA.Utils.Counter=function(){this.startTime=new Date().getTime();this.time=new Date().getTime();this.frameTime=0;this.framesNumber=0;this.FPS=0};OMEGA.Utils.Counter.prototype.update=function(){this.framesNumber++;this.frameTime=(new Date().getTime()-this.time)/1000;if(this.frameTime>1){this.FPS=Math.round(this.framesNumber/this.frameTime);this.time=new Date().getTime();this.framesNumber=0}};OMEGA.Utils.Counter.prototype.getFPS=function(){return this.FPS};OMEGA.Utils.Counter.prototype.getFrame=function(){return this.framesNumber};OMEGA.Utils.Counter.prototype.getDeltaTime=function(){return this.frameTime};OMEGA.Utils.Counter.prototype.getTime=function(){return(new Date().getTime()-this.startTime)/1000};OMEGA.Utils.Timeline=function(a){this.triggers=new Array();this.trigger_set=new Array();this.time=0;this.trigger_set_index=0;this.startTime=new Date().getTime();this.deltaTime=this.savedTime=0;this.upCommingTriggerTime=0;this.isEnabled=false;this.isDebug=a||false;this.frames=new Array()};OMEGA.Utils.Timeline.prototype.On=function(){this.isEnabled=true};OMEGA.Utils.Timeline.prototype.Off=function(){this.isEnabled=false};OMEGA.Utils.Timeline.prototype.Add=function(b,a){if(this.triggers[b]==null){this.triggers[b]=new Array()}this.triggers[b].push(a);if(this.trigger_set.indexOf(b)==-1){this.trigger_set.push(b)}};OMEGA.Utils.Timeline.prototype.Reset=function(){this.Off();this.trigger_set_index=-1;if(this.isDebug){console.log("[OMEGA :: Timeline] - Reset!")}this.startTime=new Date().getTime();this.savedTime=0;this.On()};OMEGA.Utils.Timeline.prototype.Clear=function(){this.triggers=new Array();this.upCommingTriggerTime=0;this.trigger_set_index=0};OMEGA.Utils.Timeline.prototype.Tick=function(b){if(!this.isEnabled){return}this.time=b==undefined?(new Date().getTime()-this.startTime):b;this.deltaTime=(this.time-this.savedTime);this.upCommingTriggerTime=this.trigger_set[this.trigger_set_index];if(this.triggers[this.upCommingTriggerTime]!=null&&(this.time-this.deltaTime<=this.upCommingTriggerTime&&this.time+this.deltaTime>=this.upCommingTriggerTime)){if(this.isDebug){console.log("[OMEGA :: Timeline] - Trigger fired! -> { trigger_time: "+this.upCommingTriggerTime+"ms current_time: "+this.time+"ms }")}for(var a=0;a<this.triggers[this.upCommingTriggerTime].length;a++){this.triggers[this.upCommingTriggerTime][a]()}if(this.trigger_set.length-1>this.trigger_set_index){this.trigger_set_index++}}this.savedTime=this.time};OMEGA.Utils.StringParser=function(a){this.str;this.index;this.words;this.Init(a)};OMEGA.Utils.StringParser.prototype.Init=function(a){this.str=a;this.index=0};OMEGA.Utils.StringParser.prototype.skipDelimiters=function(){for(var b=this.index,a=this.str.length;b<a;b++){var d=this.str.charAt(b);if(d=="\t"||d==" "||d=="("||d==")"||d=='"'){continue}break}this.index=b};OMEGA.Utils.StringParser.prototype.GetFirstWord=function(){this.words=this.str.split(String.fromCharCode(32));if(this.words.length==0){return null}else{return this.words[0]}};var OMEGA=OMEGA||{};OMEGA.Omega3D=OMEGA.Omega3D||{};OMEGA.Omega3D=function(){this.canvas=document.getElementById("omega");this.scenes=[];this.cameras=[];this.shaders=[];this.keylisteners=[];this.gl=null;this.context_params={alpha:true,depth:true,stencil:false,antialias:true,premultipliedAlpha:false,preserveDrawingBuffer:false,failIfMajorPerformanceCaveat:false};try{this.gl=this.canvas.getContext("experimental-webgl",this.context_params);if(this.gl==null){this.gl=canvas.getContext("webgl",this.context_params)}else{if(this.gl==null){this.gl=canvas.getContext("webgl2",this.context_params)}else{if(this.gl==null){this.gl=canvas.getContext("experimental-webgl2",this.context_params)}}}}catch(a){}if(this.gl==null){console.log("[Omega3D] Cant initiate WebGL!");return}OMEGA.Omega3D.AVAILABLE=true;this.gl.viewPortWidth=this.canvas.width;this.gl.viewPortHeight=this.canvas.height;this.canvas.addEventListener("webglcontextlost",function(){OMEGA.Omega3D.AVAILABLE=false},false);this.canvas.addEventListener("webglcontextrestored",function(){OMEGA.Omega3D.AVAILABLE=true},false);window.addEventListener("resize",function(){Omega3D.Recalibrate()},false);OMEGA.Omega3D.GL=this.gl;console.log(".: Omega3D v"+OMEGA.Omega3D.VERSION+" :.");OMEGA.Omega3D.LoadExtentions(this.gl)};OMEGA.Omega3D.LoadExtentions=function(a){Omega3D.EXT={};Omega3D.EXT.floating_point_textures=a.getExtension("OES_texture_float");if(Omega3D.EXT.floating_point_textures==null){Omega3D.Log("[Omega3D] No OES_texture_float supported in this browser.")}Omega3D.EXT.float_linear_textures=a.getExtension("OES_texture_float_linear");if(Omega3D.EXT.float_linear_textures==null){Omega3D.Log("[Omega3D] No OES_texture_float_linear supported in this browser.")}Omega3D.EXT.standard_derivatives=(a.getExtension("OES_standard_derivatives"));if(Omega3D.EXT.standard_derivatives==null){Omega3D.Log("[Omega3D] No OES_standard_derivatives supported in this browser.")}Omega3D.EXT.draw_buffers=(a.getExtension("WEBGL_draw_buffers")||a.getExtension("GL_EXT_draw_buffers")||a.getExtension("EXT_draw_buffers"));if(Omega3D.EXT.draw_buffers==null){Omega3D.Log("[Omega3D] No WEBGL_draw_buffers supported in this browser.")}Omega3D.EXT.depth_texture=(a.getExtension("WEBKIT_WEBGL_depth_texture")||a.getExtension("MOZ_OES_depth_texture")||a.getExtension("WEBKIT_OES_depth_texture")||a.getExtension("WEBGL_depth_texture")||a.getExtension("OES_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture"));if(Omega3D.EXT.depth_texture==null){Omega3D.Log("[Omega3D] No depth_textures supported in this browser.")}Omega3D.EXT.anisotropic_filtering=(a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"));if(Omega3D.EXT.anisotropic_filtering==null){Omega3D.Log("[Omega3D] No anisotropic_filtering supported in this browser.")}};OMEGA.Omega3D.Recalibrate=function(){OMEGA.Omega3D.INSTANCE.canvas.width=window.innerWidth-3.25;OMEGA.Omega3D.INSTANCE.canvas.height=window.innerHeight-3.25;OMEGA.Omega3D.INSTANCE.gl.viewPortWidth=OMEGA.Omega3D.INSTANCE.canvas.width;OMEGA.Omega3D.INSTANCE.gl.viewPortHeight=OMEGA.Omega3D.INSTANCE.canvas.height};OMEGA.Omega3D.GetGL=function(){return OMEGA.Omega3D.INSTANCE.gl};OMEGA.Omega3D.AddKeyListener=function(a){OMEGA.Omega3D.INSTANCE.keylisteners.push(a);document.keylisteners=OMEGA.Omega3D.INSTANCE.keylisteners};OMEGA.Omega3D.RemoveKeyListener=function(a){OMEGA.Omega3D.INSTANCE.keylisteners.splice(OMEGA.Omega3D.INSTANCE.keylisteners.lastIndexOf(a),1);document.keylisteners=OMEGA.Omega3D.INSTANCE.keylisteners};OMEGA.Omega3D.ReadPixels=function(c,e,b,a,i){var f=OMEGA.Omega3D.INSTANCE.gl;var g=f.createTexture();f.bindTexture(f.TEXTURE_2D,g);f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,c);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST);var h=f.createFramebuffer();f.bindFramebuffer(f.FRAMEBUFFER,h);f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,g,0);var d=new Uint8Array(a*i*4);f.readPixels(e,b,a,i,f.RGBA,f.UNSIGNED_BYTE,d);f.deleteFramebuffer(h);f.bindTexture(f.TEXTURE_2D,null);f.deleteTexture(g);return d};OMEGA.Omega3D.CreateArrayBuffer=function(b,c){var d=OMEGA.Omega3D.INSTANCE.gl;var a=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,a);d.bufferData(d.ARRAY_BUFFER,b,d.STATIC_DRAW);a.itemSize=c;a.numItems=b.length/c;return a};OMEGA.Omega3D.CreateAtlas=function(b,m,d,i,n,h,a){var e=b/d;var g=m/i;for(var j=0;j<g;j++){for(var k=0;k<e;k++){var f=k*d;var c=j*i;var l=0;n.push(f,c,l);h.push(k/(e-1));h.push(j/(g-1));if(j<g-1&&k<e-1){a.push(j*e+k);a.push(j*e+k+1);a.push((j+1)*e+k);a.push(j*e+k+1);a.push((j+1)*e+k+1);a.push((j+1)*e+k)}}}};function onload(){var a=document.getElementsByTagName("body");OMEGA.Omega3D.INSTANCE=new OMEGA.Omega3D()}if(window.addEventListener){window.addEventListener("load",onload,false)}else{if(window.attachEvent){window.attachEvent("onload",onload)}else{window.onload=onload}}document.keylisteners=[];document.onkeydown=function(b){for(var a=0;a<document.keylisteners.length;a++){document.keylisteners[a].HandleKeyDown(b)}};document.onkeyup=function(b){for(var a=0;a<document.keylisteners.length;a++){document.keylisteners[a].HandleKeyUp(b)}};String.prototype.splice=function(a,c,b){return(this.slice(0,a)+b+this.slice(a+Math.abs(c)))};OMEGA.Omega3D.Log=function(a){console.log(a)};OMEGA.Omega3D.GL=null;OMEGA.Omega3D.LIGHTS=[];OMEGA.Omega3D.PointSize=1;OMEGA.Omega3D.VERSION="0.0.1.8.1 Alpha";OMEGA.Omega3D.ScenesCount=0;OMEGA.Omega3D.ObjectsCount=0;OMEGA.Omega3D.MaterialsCount=0;OMEGA.Omega3D.INSTANCE=null;OMEGA.Omega3D.AVAILABLE=false;OMEGA.Omega3D.ShadowType={};OMEGA.Omega3D.ShadowType.PCF=0;OMEGA.Omega3D.ShadowType.VSM=0;OMEGA.Omega3D.KEEP=7680;OMEGA.Omega3D.REPLACE=7681;OMEGA.Omega3D.NEVER=512;OMEGA.Omega3D.LESS=513;OMEGA.Omega3D.EQUAL=514;OMEGA.Omega3D.LEQUAL=515;OMEGA.Omega3D.GREATER=516;OMEGA.Omega3D.NOTEQUAL=517;OMEGA.Omega3D.GEQUAL=518;OMEGA.Omega3D.ALWAYS=519;var Omega3D=OMEGA.Omega3D;OMEGA.Omega3D.ShaderUtil=OMEGA.Omega3D.ShaderUtil||{};OMEGA.Omega3D.ShaderUtil.InjectGLSLForLights=function(n,i,k,h){var d=h.getLights();if(d==null){return{vs:n,fs:i,uniforms:k}}var c="";var e="";if(d.length==0){return{vs:n,fs:i,uniforms:k}}for(var j in d){c+=d[j].vs;e+=d[j].fs;for(var l in d[j].uniforms){k[l]=d[j].uniforms[l]}}var b=n.indexOf("void main");b=b<0?0:b;n=n.splice(b,0,c);var g=n.match(/(void main\(\)|void main\(void\))(\{|\s\{)?/g);var a=g;a=a+"vTNormal = vec3( uModelMatrix * vec4(aVertexNormal, 0.0) );vViewMatrix = uViewMatrix;";var f=true;for(var j in d){if(d[j].type==OMEGA.Omega3D.POINT_LIGHT){if(f){a=a+"vMVertexPos = uModelMatrix * vec4(aVertexPos.xyz, 1.0);";f=false}}else{}}n=n.replace(/(void main\(\)|void main\(void\))(\{|\s\{)?/g,a);i=i.splice(i.indexOf("void main"),0,e);g=i.match(/(void main\(\)|void main\(void\))(\{|\s\{)?/g);a=g;a=a+"vec3 vLightWeight = vec3(0, 0, 0);";i=i.replace(/(void main\(\)|void main\(void\))(\{|\s\{)?/g,a);var m="";for(var j in d){m=m+"vLightWeight += light"+j+"( color.rgb);"}m=m+"color = vec4( vLightWeight.rgb, color.a);";i=i.splice(i.indexOf("gl_FragColor"),0,m);return{vs:n,fs:i,uniforms:k}};OMEGA.Omega3D.ShaderUtil.InjectGLSLForFog=function(k,g,h,e){var f="uniform vec3 uFogColor;uniform vec2 uFogDist;";h.uFogColor={id:"uFogColor",type:"vec3",glsl:"uniform vec3 uFogColor;",value:[e.getColor().r,e.getColor().g,e.getColor().b]};h.uFogDist={id:"uFogDist",type:"vec2",glsl:"uniform vec3 uFogDist;",value:[e.getColor().r,e.getColor().g,e.getColor().b]};var i="varying vec3 vColor;varying float vDist;";var c=k.indexOf("void main");c=c<0?0:c;k=k.splice(c,0,i);var d=k.match(/(void main\(\)|void main\(void\))(\{|\s\{)?/g);var a=d;a=a+"vDist  = distance(uModelMatrix*vec4(aVertexPos, 1.0), vec4(0, -0.5, -1, 1.0));";k=k.replace(/(void main\(\)|void main\(void\))(\{|\s\{)?/g,a);g=g.splice(g.indexOf("void main"),0,f+i);var j="";var b="void main(void){";j=j+"vec3 fogColor = vec3("+e.getColor().r+","+e.getColor().g+","+e.getColor().b+");";j=j+"vec2 fogDist  = vec2("+e.fogStart+","+e.fogEnd+");";j=j+"float fogFactor = clamp((uFogDist.y - vDist)/(uFogDist.y - uFogDist.x), 0.0, 1.0);";g=g.splice(g.indexOf("void main")+b.length,0,j);j="color = vec4(mix(uFogColor, vec3(color), fogFactor), color.a);";g=g.splice(g.indexOf("gl_FragColor"),0,j);return{vs:k,fs:g,uniforms:h}};OMEGA.Omega3D.VBOUtil=OMEGA.Omega3D.VBOUtil||{};OMEGA.Omega3D.VBOUtil.GetSimularVertexIndex=function(d,h,e,f,c,g,j){var b=f.length;for(var a=0;a<b;a++){if(d.x==f[a].x&&d.y==f[a].y&&d.z==f[a].z&&h.x==c[a].x&&h.y==c[a].y&&e.x==g[a].x&&e.y==g[a].y&&e.z==g[a].z){j=a;return true}}return false};OMEGA.Omega3D.VBOUtil.IndexTB=function(d,c,f,g,j,l,k,m,b,a){for(var e=0;e<d.length;e++){var h=-1;var n=OMEGA.Omega3D.VBOUtil.GetSimularVertexIndex(d[e],c[e],f[e],l,k,m,h);if(n){b[h].add(g[e]);a[h].add(j[e])}else{l.push(d[e]);k.push(c[e]);m.push(f[e]);b.push(g[e]);a.push(j[e])}}};OMEGA.Omega3D.VBOUtil.ComputeIndices=function(a,d,e){for(var c=0;c<d;c++){for(var b=0;b<a;b++){if(c<d-1&&b<a-1){e.push(c*a+b,c*a+b+1,(c+1)*a+b);e.push(c*a+b+1,(c+1)*a+b+1,(c+1)*a+b)}}}};OMEGA.Omega3D.VBOUtil.FlattenMeshDataTB=function(d,c,f,g,h,k,j,l,b,a){for(var e=0;e<d.length;e++){k.push(d[e].x,d[e].y,d[e].z);j.push(c[e].x,c[e].y);l.push(f[e].x,f[e].y,f[e].z);b.push(g[e].x,g[e].y,g[e].z);a.push(h[e].x,h[e].y,h[e].z)}};OMEGA.Omega3D.VBOUtil.ComputeTangentBasis=function(g,l,n,c,t){var w=3;for(var o=0;o<g.length;o+=w){var f=g[o];var e=g[o+1];var d=g[o+2];if(f==null||e==null||d==null){break}var s=l[o];var q=l[o+1];var p=l[o+2];var b=Vector3.Subtract(e,f);var a=Vector3.Subtract(d,f);var k=Vector2.Subtract(q,s);var j=Vector2.Subtract(p,s);var v=(k.x*j.y-k.y*j.x);var m=v>0?1/(k.x*j.y-k.y*j.x):1;var h=Vector3.MultiplyByValue(Vector3.Subtract(Vector3.MultiplyByValue(b,j.y),Vector3.MultiplyByValue(a,k.y)),m);var u=Vector3.MultiplyByValue(Vector3.Subtract(Vector3.MultiplyByValue(a,k.x),Vector3.MultiplyByValue(b,j.x)),m);c.push(h);c.push(h);c.push(h);t.push(u);t.push(u);t.push(u)}c.push(h);t.push(u)};function Object3D(b,a){this.id=(++OMEGA.Omega3D.ObjectsCount).toString();this.name="Object3d_"+this.id.toString();this.mayRender=true;this.next=null;this.prev=null;this.parentScene=null;this.position=[0,0,0];this.rotation=[0,0,0];this.scale=[1,1,1];this.sMatrix=mat4.create();this.tMatrix=mat4.create();this.rMatrix=mat4.create();this.modelView=mat4.create();mat4.identity(this.modelView);this.mayRender=true;this.mesh=b;this.material=a;this.drawType=0;if(this.mesh){this.mesh.CreateBuffers();this.mesh.CreateColorPickingBuffer(this.id)}this.parent=null;this.children=[];this.SetName=function(c){this.name=c};this.SetMesh=function(c){this.mesh=c};this.SetMaterial=function(c){this.material=c};this.SetMatrix=function(c){this.modelView=c};this.GetPosition=function(){return this.position};this.GetRotation=function(){return this.rotation};this.GetMesh=function(){return this.mesh};this.GetMaterial=function(){return this.material};this.GetMatrix=function(){mat4.identity(this.modelView);if(this.parent!=null){this.modelView=this.parent.GetMatrix()}mat4.multiply(this.modelView,this.modelView,this.tMatrix);mat4.multiply(this.modelView,this.modelView,this.rMatrix);mat4.multiply(this.modelView,this.modelView,this.sMatrix);return this.modelView};this.GetName=function(){return this.name};this.GetID=function(){return this.id};this.Identity=function(){this.position=[0,0,0];this.rotation=[0,0,0];this.scale=[1,1,1];this.SetScale(this.scale[0],this.scale[1],this.scale[2]);this.SetPosition(this.position[0],this.position[1],this.position[2]);this.SetRotation(this.rotation[0],this.rotation[1],this.rotation[2]);mat4.identity(this.modelView)};this.PlaceBack=function(){this.SetScale(this.scale[0],this.scale[1],this.scale[2]);this.SetPosition(this.position[0],this.position[1],this.position[2]);this.SetRotation(this.rotation[0],this.rotation[1],this.rotation[2])};this.SetScale=function(c,e,d){this.scale=[c,e,d];mat4.identity(this.sMatrix);mat4.scale(this.sMatrix,this.sMatrix,this.scale)};this.SetPosition=function(c,e,d){this.position=[c,e,d];mat4.identity(this.tMatrix);mat4.translate(this.tMatrix,this.tMatrix,this.position)};this.Translate=function(c,e,d){this.position[0]+=c;this.position[1]+=e;this.position[2]+=d;mat4.identity(this.tMatrix);mat4.translate(this.tMatrix,this.tMatrix,this.position)};this.SetRotation=function(c,e,d){mat4.identity(this.rMatrix);this.rotation=[c,e,d];mat4.rotate(this.rMatrix,this.rMatrix,this.rotation[0],[1,0,0]);mat4.rotate(this.rMatrix,this.rMatrix,this.rotation[1],[0,1,0]);mat4.rotate(this.rMatrix,this.rMatrix,this.rotation[2],[0,0,1])};this.Rotate=function(c,e,d){mat4.identity(this.rMatrix);this.RotateX(c);this.RotateY(e);this.RotateZ(d)};this.RotateX=function(c){this.rotation[0]+=c;mat4.rotate(this.rMatrix,this.rMatrix,this.rotation[0],[1,0,0])};this.RotateY=function(c){this.rotation[1]+=c;mat4.rotate(this.rMatrix,this.rMatrix,this.rotation[1],[0,1,0])};this.RotateZ=function(c){this.rotation[2]+=c;mat4.rotate(this.rMatrix,this.rMatrix,this.rotation[2],[0,0,1])};this.GetChildByName=function(c){for(var d=0;d<this.children.length;d++){if(this.children[d].name==c){return this.children[d]}}return null};this.SetParent=function(c){if(this.parent!=null){this.parent.children.splice(this.parent.children.indexOf(this),1)}this.parent=c;if(c!=null){this.parent.children.push(this)}};this.Update=function(d,c){};this.LateUpdate=function(d,c){};this.Clone=function(g){var e;var d;var h;g=g||false;if(this.GetMesh()){e=this.GetMesh().GetGeometry()}if(this.material){d=this.material.Clone()}var f=new Omega3D.Object3D(e?new Omega3D.Mesh(e):null,d?d:null);f.name=this.name+"_Clone_"+this.id;for(var c=0;c<this.children.length;c++){if(g&&this.isShadowCaster){h=this.children[c].Clone(true);h.SetParent(f)}else{if(!g){h=this.children[c].Clone();h.SetParent(f)}}}if(g){f.sMatrix=this.sMatrix;f.tMatrix=this.tMatrix;f.rMatrix=this.rMatrix;f.position=this.position;f.rotation=this.rotation;f.scale=this.scale}return f};this.toString=function(){return"Object3D { id: "+this.id+", name: "+this.name+"};"}}OMEGA.Omega3D.Object3D=Object3D;OMEGA.Omega3D.Object3D.DEFAULT=0;OMEGA.Omega3D.Object3D.POINTS=1;OMEGA.Omega3D.Object3D.WIREFRAME=2;OMEGA.Omega3D.Object3D.TRIANGLES=3;function LODObject3D(c,a,b){Object3D.apply(this,[c,a]);this.levels=b;this.current_level=0;this.meshes=new Array();this.createMeshes=function(){for(var e=0;e<this.levels+1;e++){var f=new Omega3D.Geometry.SphereGeometry(this.mesh.GetGeometry().scale,6+e*3,2+e*5);var d=new Mesh(f);d.CreateBuffers();this.meshes.push(d)}this.SetMesh(this.meshes[this.current_level])};this.Update=function(e,d){this.adjustLODLevel(d)};this.adjustLODLevel=function(f){var i=f.GetPosition();var e=this.GetPosition();var h=[-i[0]-e[0],-i[1]-e[1],-i[2]-e[2]];var g=Math.sqrt(h[0]*h[0]+h[1]*h[1]+h[2]*h[2])/(this.mesh.GetGeometry().scale*2);var d=this.levels-Math.floor(g);if(d==this.current_level){return}if(d>this.levels){this.current_level=this.levels}else{if(d<0){this.current_level=0}else{this.current_level=d}}this.SetMesh(this.meshes[this.current_level])};if(this.mesh){this.createMeshes()}}LODObject3D.prototype=Object3D;OMEGA.Omega3D.LODObject3D=LODObject3D;function BlendObject3D(b,a){Object3D.apply(this,[b,a]);this.Update=function(d,c){d.disable(d.DEPTH_TEST);d.enable(d.BLEND);d.blendFunc(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA)};this.LateUpdate=function(d,c){d.enable(d.DEPTH_TEST);d.disable(d.BLEND)}}BlendObject3D.prototype=new Object3D();OMEGA.Omega3D.BlendObject3D=BlendObject3D;OMEGA.Omega3D.Light=function(c,b,d,e){Object3D.apply(this,[null,null]);this.SetRadius=function(f){this.radius=f};this.GetRadius=function(){return this.radius};this.SetDirection=function(f,h,g){this.direction[0]=f;this.direction[1]=h;this.direction[2]=g;this.invdirection[0]=-f;this.invdirection[1]=-h;this.invdirection[2]=-g;this.LookAt(f,h,g,this.position)};this.SetAmbient=function(i,h,f){this.ambientColor[0]=i;this.ambientColor[1]=h;this.ambientColor[2]=f};this.SetDiffuse=function(i,h,f){this.diffuseColor[0]=i;this.diffuseColor[1]=h;this.diffuseColor[2]=f};this.SetSpecular=function(i,h,f){this.specularColor[0]=i;this.specularColor[1]=h;this.specularColor[2]=f};this.GetDirection=function(){return this.direction};this.GetSpecular=function(){return this.specularColor};this.GetDiffuse=function(){return this.diffuseColor};this.GetAmbient=function(){return this.ambientColor};this.GetInvDirection=function(){return this.invdirection};this.LookAt=function(g,i,h,f){mat4.identity(a);mat4.lookAt(a,f||this.position,[g,i,h],[0,1,0])};this.GetMatrix=function(){mat4.identity(this.modelView);mat4.multiply(this.modelView,this.rMatrix,this.tMatrix);mat4.multiply(this.modelView,this.modelView,this.sMatrix);mat4.multiply(this.modelView,this.modelView,a);return this.modelView};this.GenerateGLSL=function(){if(this.type==0){this.glsl=this.genDirectional()}else{if(this.type==1){this.glsl=this.genPoint()}else{if(this.type==2){this.glsl=this.genSpot()}}}};this.genUniforms=function(){var f="";if(this.type==0){f+="uniform vec3 u"+this.id+"Direction;\n";this.uniforms["u"+this.id+"Direction"]={type:"vec3",glsl:"uniform vec3 u"+this.id+"Direction;",value:this.GetDirection}}else{if(this.type==1){f+="uniform vec3 u"+this.id+"Position;\n";f+="uniform float u"+this.id+"Radius;\n";this.uniforms["u"+this.id+"Position"]={type:"vec3",glsl:"uniform vec3 u"+this.id+"Position;",value:this.GetPosition};this.uniforms["u"+this.id+"Radius"]={type:"float",glsl:"uniform float u"+this.id+"Radius;",value:this.GetRadius}}else{if(this.type==2){f+="uniform vec3 u"+this.id+"Position;\n";f+="uniform float u"+this.id+"Radius;\n";f+="uniform vec3 u"+this.id+"Direction;\n";this.uniforms["u"+this.id+"Position"]={type:"vec3",glsl:"uniform vec3 u"+this.id+"Position;",value:this.GetPosition};this.uniforms["u"+this.id+"Radius"]={type:"float",glsl:"uniform float u"+this.id+"Radius;",value:this.GetRadius};this.uniforms["u"+this.id+"Direction"]={type:"vec3",glsl:"uniform vec3 u"+this.id+"Direction;",value:this.GetDirection}}}}f+="uniform vec3 u"+this.id+"Ambient;\n";f+="uniform vec3 u"+this.id+"Diffuse;\n";f+="uniform vec3 u"+this.id+"Specular;\n";this.uniforms["u"+this.id+"Ambient"]={type:"vec3",glsl:"uniform vec3 u"+this.id+"Ambient;",value:this.GetAmbient};this.uniforms["u"+this.id+"Diffuse"]={type:"vec3",glsl:"uniform vec3 u"+this.id+"Diffuse;",value:this.GetDiffuse};this.uniforms["u"+this.id+"Specular"]={type:"vec3",glsl:"uniform vec3 u"+this.id+"Specular;",value:this.GetSpecular};return f};this.genVarying=function(){var f=["varying vec3 vTNormal;","varying vec4 vMVertexPos;","varying mat4 vViewMatrix;"].join("\n");return f};this.genDirectional=function(){var f=this.genUniforms();var g=this.index==0?this.genVarying():"";this.vs=[g].join("\n");this.fs=[f,g,"vec3 "+this.id+"(vec3 color){","vec3 lightDir = normalize( u"+this.id+"Direction );","float dirLightWeight = max(dot(normalize(vTNormal) , lightDir), 0.0);","vec3 eyeWorldPos       = vec3(vViewMatrix[3].xyz);","vec3 viewVectorEye     = normalize(vMVertexPos.xyz - eyeWorldPos);","vec3 halfVector        = normalize( viewVectorEye + lightDir );","float strength         = pow(max(dot(normalize(vTNormal),halfVector), 0.0), 25.0);","vec3 diffuse  = (uDiffuse * u"+this.id+"Diffuse *  dirLightWeight);","vec3 ambient  = (uAmbient * u"+this.id+"Ambient);","vec3 specular = (uSpecular *  u"+this.id+"Specular * strength);","vec3 lightFinalColor =  ((ambient + diffuse + specular)* color);","return lightFinalColor;","}"].join("\n")};this.genPoint=function(){var f=this.genUniforms();var g=this.index==0?this.genVarying():"";this.vs=[g].join("\n");this.fs=[f,g,"vec3 "+this.id+"( vec3 color ){","vec4 mvLight           = vec4(u"+this.id+"Position, 1.0) ;","vec3 lightVec          = vec3(vMVertexPos) - vec3(mvLight);","float lightLength      =  length(lightVec);","vec3 lightDir          = normalize(lightVec/lightLength);","lightLength            = lightLength * lightLength;","float dirLightWeight   = max(dot(normalize(vTNormal), lightDir), 0.0);","vec3 eyeWorldPos       = vec3(vViewMatrix[3].xyz);","vec3 viewVectorEye     = normalize(vMVertexPos.xyz - eyeWorldPos );","vec3 halfVector        = normalize( viewVectorEye + lightDir );","float strength         = min(1.0, pow(max(dot(normalize(vTNormal),halfVector), 0.0), 25.0));","float cutoff = 0.0001;","float radius = u"+this.id+"Radius;","float d      = max(lightLength -radius, 0.0);","float denom  = d/radius + 1.0;","float attenuation = 1.0 / (denom*denom);","attenuation = ( attenuation -cutoff) / (1.0-cutoff);","attenuation = max( attenuation, 0.0);","vec3 diffuse  = (uDiffuse * u"+this.id+"Diffuse *  dirLightWeight) *attenuation;","vec3 ambient  = (uAmbient * u"+this.id+"Ambient);","vec3 specular = (uSpecular *  u"+this.id+"Specular * strength) * attenuation;","vec3 lightFinalColor = ((ambient + diffuse + specular)* color);","return lightFinalColor;","}"].join("\n")};this.genSpot=function(){var f=this.genUniforms();var g=this.index==0?this.genVarying():"";this.vs=[g].join("\n");this.fs=[f,g,"vec3 "+this.id+"( vec3 color ){","vec4 mvLight           = vec4(u"+this.id+"Position, 1.0) ;","vec3 lightVec          = vec3(vMVertexPos) - vec3(mvLight);","float lightLength      = length(lightVec);","vec3 lightDir          = normalize(lightVec/lightLength);","float dirLightWeight   = max(dot(vTNormal, lightDir), 0.0);","lightLength = lightLength / 2.0;","float fConeCosine =  0.8;","float fCosine  = dot(  u"+this.id+"Direction, lightDir);","float fDif     = 1.0 - fConeCosine;","float fFactor  = clamp( ( fCosine - fConeCosine ) / fDif, 0.0, 1.0);","vec3 ambient  = (uAmbient * u"+this.id+"Ambient);","vec3 diffuse  = (uDiffuse * u"+this.id+"Diffuse *  dirLightWeight);","color = vec3(0);","vec3 lightFinalColor = vec3(0);","if( fCosine > fConeCosine)","lightFinalColor = (diffuse) * fFactor / ( lightLength * 1.0);","return lightFinalColor;","}"].join("\n")};this.setIndex=function(f){this.index=f;this.id="light"+this.index.toString()};this.uniforms={};this.type=c||0;this.vs="";this.fs="";this.index=0;this.id="light"+this.index.toString();this.direction=[0,0,0];this.invdirection=[0,0,0];var a=mat4.create();this.radius=100;this.ambientColor=b||[0,0,0];this.diffuseColor=d||[0.1,0.1,0.1];this.specularColor=e||[0,0,0]};OMEGA.Omega3D.DIRECTIONAL_LIGHT=0;OMEGA.Omega3D.POINT_LIGHT=1;OMEGA.Omega3D.SPOT_LIGHT=2;OMEGA.Omega3D.Scene=function(a){this.scene_params=a||{shadows:false};this.id=(++OMEGA.Omega3D.ScenesCount).toString();this.name="Scene_"+this.id;this.renderer=null;this.gl=OMEGA.Omega3D.GL;this.children=new Array();this.objects=new Array();this.materials=new Array();this.list=new Array();this.lights=new Array();this.counter=new OMEGA.Utils.Counter();this.color={r:0.5,g:0.5,b:0.5,a:1};this.hasFog=false;this.fogStart=1;this.fogEnd=3;this.lightsON=true;if(this.scene_params.shadows==true){this.shadowScene=new Omega3D.Scene();this.shadowScene.setColor(1,1,0);this.shadowSceneMat=new Omega3D.Material(new Omega3D.Shaders.DepthMap(),[])}this.getLights=function(){return this.lights};this.addLight=function(b){b.setIndex(this.lights.length);b.GenerateGLSL();this.lights.push(b)};this.removeLight=function(b){this.lights.splice(this.lights.indeOf(b),1)};this.getColor=function(){return this.color};this.setColor=function(e,d,c){this.color={r:e,g:d,b:c,a:1};this.gl.clearColor(this.color.r,this.color.g,this.color.b,this.color.a)};this.checkForMaterial=function(c){for(var b=0;b<this.materials.length;b++){if(this.materials[b].id==c){return true}}return false};this.setName=function(b){this.name=b};this.getName=function(){return this.name};this.getID=function(){return this.id};this.getMaterials=function(b){return materials[b]};this.getObjectsFromMaterialID=function(b){return objects[b]}};OMEGA.Omega3D.Scene.prototype.getGL=function(){return this.gl};OMEGA.Omega3D.Scene.prototype.addChild=function(d,a){this.children.push(d);d.parentScene=this;a=a||false;d.isShadowCaster=a;if(d.isShadowCaster==true&&this.scene_params.shadows==true){var b=d.Clone(true);b.SetMaterial(this.shadowSceneMat);this.shadowScene.addChild(b)}};OMEGA.Omega3D.Scene.prototype.removeChild=function(b){for(var a=0;a<this.children.length;a++){if(this.children[a]==b){this.children.splice(a,1)}}b.parentScene=null;b=null};OMEGA.Omega3D.Scene.prototype.removeChildAtIndex=function(a){var b=this.children.splice(a,1);b.parentScene=null;b=null};OMEGA.Omega3D.Scene.prototype.update=function(){this.counter.update()};OMEGA.Omega3D.Scene.prototype.getTime=function(){return this.counter.getTime()};OMEGA.Omega3D.Scene.prototype.getDeltaTime=function(){return this.counter.getDeltaTime()};OMEGA.Omega3D.Scene.prototype.getFPS=function(){return this.counter.getFPS()};OMEGA.Omega3D.Scene.prototype.getFrameNumber=function(){return this.counter.getFrame()};function Cube(b,a){Object3D.apply(this,[new Omega3D.Mesh(new Omega3D.Geometry.CubeGeometry(b)),a])}Cube.prototype=new Object3D();OMEGA.Omega3D.Cube=Cube;function Cylinder(b,a){Object3D.apply(this,[new Omega3D.Mesh(new Omega3D.Geometry.CylinderGeometry(b,b/4)),a])}Cylinder.prototype=new Object3D();OMEGA.Omega3D.Cylinder=Cylinder;function Cylinder(b,a){Object3D.apply(this,[new Omega3D.Mesh(new Omega3D.Geometry.CylinderGeometry(b,b/4)),a])}Cylinder.prototype=new Object3D();OMEGA.Omega3D.Cylinder=Cylinder;function Sphere(d,b,c,a){Object3D.apply(this,[new Omega3D.Mesh(new Omega3D.Geometry.SphereGeometry(d,c,a)),b])}Sphere.prototype=new Object3D();OMEGA.Omega3D.Sphere=Sphere;function Torus(b,a){Object3D.apply(this,[new Omega3D.Mesh(new Omega3D.Geometry.TorusGeometry(b,b/4*2)),a])}Torus.prototype=new Object3D();OMEGA.Omega3D.Torus=Torus;function ParticleEmitter(b){var a=new OMEGA.Omega3D.Mesh(new OMEGA.Omega3D.Geometry());Object3D.apply(this,[a,b]);this.alphaBlend=true;this.drawType=OMEGA.Omega3D.Object3D.POINTS;this.sortParticles=true;this.particles=new Array();this.AddParticle=function(c){this.particles.push(c.x,c.y,c.z);this.GetMesh().GetGeometry().SetVertices(this.particles);this.GetMesh().CreateBuffers()};this.AddParticles=function(c){this.particles=c;this.GetMesh().GetGeometry().SetVertices(this.particles);this.GetMesh().CreateBuffers()};this.Update=function(d,c){if(this.alphaBlend){d.disable(d.DEPTH_TEST);d.enable(d.BLEND);d.blendEquation(d.FUNC_ADD);d.blendFunc(d.ONE,d.ONE)}};this.LateUpdate=function(d,c){if(this.alphaBlend){d.enable(d.DEPTH_TEST);d.disable(d.BLEND)}};this.sort=function(c){this.particles.sort(function(e,d){return e[2]-d[2]})}}ParticleEmitter.prototype=new Object3D();OMEGA.Omega3D.Particles=OMEGA.Omega3D.Particles||{};OMEGA.Omega3D.Particles.ParticleEmitter=ParticleEmitter;function Camera(){Object3D.apply(this);this.projectionMatrix=mat4.create();this.laMatrix=mat4.create();this.fov=45;this.near=0.1;this.far=1000;this.ratio="DEFAULT";this.x=this.y=this.z=0;this.lookX=this.lookY=this.lookZ=0;this.GetProjectionMatrix=function(){mat4.perspective(this.projectionMatrix,this.fov,this.ratio=="DEFAULT"?OMEGA.Omega3D.GL.viewPortWidth/OMEGA.Omega3D.GL.viewPortHeight:this.ratio,this.near,this.far);return this.projectionMatrix};this.GetMatrix=function(){mat4.identity(this.modelView);mat4.multiply(this.modelView,this.rMatrix,this.tMatrix);mat4.multiply(this.modelView,this.modelView,this.sMatrix);mat4.multiply(this.modelView,this.modelView,this.laMatrix);return this.modelView};this.GetInverseMatrix=function(){var a=mat4.create();mat4.invert(a,this.GetMatrix());return a};this.update=function(){this.LookAt(this.lookX,this.lookY,this.lookZ,[this.x,this.y,this.z])};this.LookAt=function(b,d,c,a){this.lookX=b;this.lookY=d;this.lookZ=c;this.x=a[0];this.y=a[1];this.z=a[2];this.position=[this.x,this.y,this.z];mat4.identity(this.laMatrix);mat4.lookAt(this.laMatrix,a||this.position,[this.lookX,this.lookY,this.lookZ],[0,-1,0])};this.LookAtWithUp=function(c,e,d,b,a){this.lookX=c;this.lookY=e;this.lookZ=d;this.x=b[0];this.y=b[1];this.z=b[2];mat4.identity(this.laMatrix);mat4.lookAt(this.laMatrix,b||this.position,[this.lookX,this.lookY,this.lookZ],a)}}Camera.prototype=new Object3D();OMEGA.Omega3D.cameras=OMEGA.Omega3D.cameras||{};OMEGA.Omega3D.cameras.Camera=Camera;function DepthCamera(a){Camera.apply(this);this.light=a;this.size=5;this.GetProjectionMatrix=function(){mat4.ortho(this.projectionMatrix,-this.size,this.size,-this.size,this.size,-this.size,this.size*2);return this.projectionMatrix};this.LookAt(0,0,0,this.light.GetPosition())}DepthCamera.prototype=new Camera();OMEGA.Omega3D.cameras=OMEGA.Omega3D.cameras||{};OMEGA.Omega3D.cameras.DepthCamera=DepthCamera;function FreeCamera(){Camera.apply(this);this.speed=0.1;this.drag=0.1;this.mass=1;this.force=0;this.pos=new Vector3(0,0,0);this.vel=new Vector3(0,0,0);this.rot=new Vector3(0,0,0);this.rotF=new Vector3(0,0,0);this.acc=new Vector3(0,0,0);this.rot_acc=new Vector3(0,0,0);this.enabled=true;this.listener=null;this.dirX,this.dirY,this.dirZ;this.SetPosition=function(a,c,b){this.pos.x=a;this.pos.y=c;this.pos.z=b};this.SetListener=function(a){this.listener=a;Omega3D.AddKeyListener(a)};this.RemoveListener=function(){Omega3D.RemoveKeyListener(this.listener)};this.GetListener=function(){return this.listener};this.SetSpeed=function(a){this.speed=a};this.update=function(){if(!this.listener||!this.enabled){return}this.HandleKeys();this.dirX=Math.cos(this.rot.y+Math.PI/2);this.dirZ=Math.sin(this.rot.y+Math.PI/2);this.dirY=Math.sin(this.rot.x);this.vel.z=this.force*this.dirZ;this.vel.x=this.force*this.dirX;this.vel.y=this.force*this.dirY;this.pos.z+=this.vel.z;this.pos.x+=this.vel.x;this.pos.y+=this.vel.y;this.force*=this.drag;this.acc.x*=this.drag;this.lookX=this.pos.x+this.dirX;this.lookY=this.pos.y+this.dirY;this.lookZ=this.pos.z+this.dirZ;this.LookAt(this.lookX,this.lookY,this.lookZ,[this.pos.x,this.pos.y,this.pos.z])};this.HandleKeys=function(){if(this.listener.currentlyPressedKeys[87]){this.vel.z=0;this.force+=this.speed}if(this.listener.currentlyPressedKeys[83]){this.vel.z=0;this.force+=-this.speed}if(this.listener.currentlyPressedKeys[39]||this.listener.currentlyPressedKeys[68]||this.listener.currentlyPressedKeys[102]){this.rotF.y=-0.05;this.rot.y+=this.rotF.y}if(this.listener.currentlyPressedKeys[37]||this.listener.currentlyPressedKeys[65]||this.listener.currentlyPressedKeys[100]){this.rotF.y=0.05;this.rot.y+=this.rotF.y}if(this.listener.currentlyPressedKeys[38]||this.listener.currentlyPressedKeys[104]){this.rotF.x=-0.05;this.rot.x+=this.rotF.x}if(this.listener.currentlyPressedKeys[40]||this.listener.currentlyPressedKeys[98]){this.rotF.x=0.05;this.rot.x+=this.rotF.x}};this.Enable=function(){if(this.enabled){return}if(this.listener){this.listener.Enable()}this.enabled=true};this.Disable=function(){if(!this.enabled){return}if(this.listener){this.listener.Disable()}this.enabled=false};this.Enable()}FreeCamera.prototype=new Camera();OMEGA.Omega3D.cameras=OMEGA.Omega3D.cameras||{};OMEGA.Omega3D.cameras.FreeCamera=FreeCamera;function Material(b,a){this.materialID="material_"+(++OMEGA.Omega3D.MaterialsCount);this.textures=a||null;this.shader=b||null;this.diffuse=[1,1,1];this.ambient=[1,1,1];this.specular=[1,1,1];this.hasAtlas=false;this.atlas=null;this.GetTextures=function(){return this.textures};this.SetTextures=function(c){this.textures=c};this.GetShader=function(){return this.shader};this.SetShader=function(c){this.shader=c};this.GetID=function(){return this.materialID};this.SetAtlas=function(c){this.hasAtlas=true;this.atlas=c};this.GetCurrentAtlasFrame=function(){return this.atlas.GetCurrentFrame().uvRect};this.Enable=function(){if(this.shader){this.shader.Enable()}if(this.textures){for(var c=0;c<this.textures.length;c++){if(c>0){this.textures[c].tex_id="uSampler_"+c;this.textures[c].ID=c}this.textures[c].Enable(this.shader)}for(var c=0;c<this.textures.length;c++){if(c>0){this.textures[c].tex_id="uSampler";this.textures[c].ID=0}}}};this.Disable=function(){if(this.shader){this.shader.Disable()}if(this.textures){var c=this.textures.length;for(var d=0;d<c;d++){this.textures[d].Disable()}}};this.GetSpecular=function(){return this.specular};this.GetDiffuse=function(){return this.diffuse};this.GetAmbient=function(){return this.ambient};this.SetAmbient=function(e,d,c){this.ambient[0]=e;this.ambient[1]=d;this.ambient[2]=c};this.SetDiffuse=function(e,d,c){this.diffuse[0]=e;this.diffuse[1]=d;this.diffuse[2]=c};this.SetSpecular=function(e,d,c){this.specular[0]=e;this.specular[1]=d;this.specular[2]=c};this.genUniforms=function(){this.uniforms.uAmbient={type:"vec3",glsl:"uniform vec3 uAmbient;",value:this.GetAmbient};this.uniforms.uDiffuse={type:"vec3",glsl:"uniform vec3 uDiffuse;",value:this.GetDiffuse};this.uniforms.uSpecular={type:"vec3",glsl:"uniform vec3 uSpecular;",value:this.GetSpecular}};this.uniforms={};this.custom_uniforms={};this.custom_attribs={};this.genUniforms();this.Clone=function(){var c=new Omega3D.Material(this.shader.Clone(),this.textures);c.uniforms=this.uniforms;c.custom_uniforms=this.custom_uniforms;c.custom_attribs=this.custom_attribs;c.SetDiffuse(this.diffuse[0],this.diffuse[1],this.diffuse[2]);c.SetSpecular(this.specular[0],this.specular[1],this.specular[2]);return c}}OMEGA.Omega3D.Material=Material;function Atlas(b){this.image_rect=b;this.segments=new Array();var d=null;var a=0;this.AddSegment=function(f,c){this.segments.push({rect:c,uvRect:new Rect(1/(this.image_rect.w/c.x),1/(this.image_rect.h/c.y),c.w/this.image_rect.w,c.h/this.image_rect.h)});this.Update()};var e=0;this.Update=function(c){if(c==null){return}e=(c.getTime()*30)%(this.segments.length);d=this.segments[Math.floor(e)];if(e>this.segments.length-1){e=0}};this.GetCurrentFrame=function(){return d}}OMEGA.Omega3D.Atlas=Atlas;function ShaderMaterial(c,d){this.scene=d;var f={};var b={};b.aTextureCoord={type:"vec2",glsl:"attribute vec2 aTextureCoord;",value:null};b.aVertexPos={type:"vec3",glsl:"attribute vec3 aVertexPos;",value:null};b.aVertexNormal={type:"vec3",glsl:"attribute vec3 aVertexNormal;",value:null};b.aVertexTangent={type:"vec3",glsl:"attribute vec3 aVertexTangent;",value:null};b.aVertexBitangent={type:"vec3",glsl:"attribute vec3 aVertexBitangent;",value:null};b.aBaricentric={type:"vec3",glsl:"attribute vec3 aBaricentric;",value:null};b.aPickingColor={type:"vec3",glsl:"attribute vec3 aPickingColor;",value:null};this.attribs=b;var g={};g.uModelMatrix={type:"mat4",glsl:"uniform mat4 uModelMatrix;",value:null};g.uProjectionMatrix={type:"mat4",glsl:"uniform mat4 uProjectionMatrix;",value:null};g.uViewMatrix={type:"mat4",glsl:"uniform mat4 uViewMatrix;",value:null};g.uInvViewMatrix={type:"mat4",glsl:"uniform mat4 uInvViewMatrix;",value:null};g.uNormalMatrix={type:"mat3",glsl:"uniform mat3 uNormalMatrix;",value:null};this.uniforms=g;var e={};this.custom_uniforms={};this.custom_attribs=e;var i=this;this.Clear=function(){for(var j in this.custom_uniforms){this.custom_uniforms[j]={type:this.custom_uniforms[j].type,glsl:this.custom_uniforms[j].glsl,value:null}}};this.SetValue=function(j,k){var l=g[j]||b[j]||this.custom_uniforms[j];if(l){l.value=k}};this.GetValue=function(j){var k=g[j]||b[j]||this.custom_uniforms[j]||{value:null};return k.value};this.processData=function(m){var k=0;for(var j in m.uniforms){var l="";l="uniform "+m.uniforms[j].type+" "+j+";";if(m.uniforms[j].type!="sampler2D"&&m.uniforms[j].type!="samplerCube"){this.custom_uniforms[j]={type:m.uniforms[j].type,glsl:l,value:m.uniforms[j].value}}else{f[j]={id:j,type:m.uniforms[j].type,glsl:l,value:null};m.uniforms[j].value.tex_id=j;m.uniforms[j].value.ID=k++;this.textures.push(m.uniforms[j].value)}}for(var j in m.attribs){var l="";l="attribute "+m.attribs[j].type+" "+j+";";this.custom_attribs[j]={type:m.attribs[j].type,glsl:l,value:m.attribs[j].value}}};var h=function(){OMEGA.Omega3D.Log(" >> ShaderMaterial: Creating custom shader");var k="";k+=a(b);k+=a(e);k+=a(g);k+=c.vertex_src;var j="precision mediump float;";j+=c.fragment_src;return new OMEGA.Omega3D.Shader(k,j,[b,g,i.custom_uniforms,f,e])};var a=function(j){var k="";for(var l in j){k+="\n"+j[l].glsl}return k};Material.apply(this,[null,[]]);this.processData(c);this.shader=h()}ShaderMaterial.prototype=new Material();OMEGA.Omega3D.ShaderMaterial=ShaderMaterial;function BasicMaterial(a,c,b){Material.apply(this,[new OMEGA.Omega3D.Shaders.Basic(a.length>0,c,b?b:[1,1,1]),a])}BasicMaterial.prototype=new Material();OMEGA.Omega3D.BasicMaterial=BasicMaterial;function ShadowMapMaterial(a,c,b){Material.apply(this,[new OMEGA.Omega3D.Shaders.SM(c),a]);this.shadowMapTexture=new ShadowMapTexture(1024,1024,a.length);this.textures.push(this.shadowMapTexture);this.custom_uniforms.uLightM={type:"mat4",glsl:"",value:b.GetMatrix()}}ShadowMapMaterial.prototype=new Material();OMEGA.Omega3D.ShadowMapMaterial=ShadowMapMaterial;function CubeMapMaterial(a,b){Material.apply(this,[new OMEGA.Omega3D.Shaders.CubeMap(b),a])}CubeMapMaterial.prototype=new Material();OMEGA.Omega3D.CubeMapMaterial=CubeMapMaterial;function SkyBoxMaterial(a,b){Material.apply(this,[new OMEGA.Omega3D.Shaders.SkyBox(b),a])}SkyBoxMaterial.prototype=new Material();OMEGA.Omega3D.SkyBoxMaterial=SkyBoxMaterial;function SEMMaterial(a,b){Material.apply(this,[new Omega3D.Shaders.SEM(b),a])}SEMMaterial.prototype=new Material();OMEGA.Omega3D.SEMMaterial=SEMMaterial;function VSMMaterial(a,c,b){Material.apply(this,[new OMEGA.Omega3D.Shaders.VSM(c),a]);this.custom_uniforms.uLightM={type:"mat4",glsl:"",value:b.GetMatrix()}}VSMMaterial.prototype=new Material();OMEGA.Omega3D.VSMMaterial=VSMMaterial;OMEGA.Omega3D.Shaders=OMEGA.Omega3D.Shaders||{};OMEGA.Omega3D.Shaders.Components=OMEGA.Omega3D.Shaders.Components||{};OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float=function(){return"precision mediump float;"};OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Highp_Float=function(){return"precision highp float;"};OMEGA.Omega3D.Shaders.Components.Basic_TextureCoords=function(){return"vTexCoord = aTextureCoord;"};OMEGA.Omega3D.Shaders.Components.Basic_Includes=function(){var a="attribute vec2 aTextureCoord;attribute vec3 aVertexPos;attribute vec3 aVertexNormal;attribute vec3 aVertexColor;attribute vec3 aPickingColor;uniform mat4 uModelMatrix;uniform mat4 uProjectionMatrix;uniform mat4 uViewMatrix;uniform mat4 uInvViewMatrix;uniform vec3 uCamPos;uniform mat3 uNormalMatrix;";return a};OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes=function(){var a="uniform vec3 uDiffuse;uniform vec3 uAmbient;uniform vec3 uSpecular;";return a};OMEGA.Omega3D.Shaders.Components.Basic_Includes_Post_Processing=function(){var a="attribute vec2 aTextureCoord;attribute vec3 aVertexPos;attribute vec3 aVertexNormal;uniform float uTime;uniform mat4 uModelMatrix;uniform mat4 uProjectionMatrix;uniform mat4 uViewMatrix;uniform mat3 uNormalMatrix;";return a};OMEGA.Omega3D.Shaders.Components.Vertex_World_Conversion_V3=function(b,a){return b+" = uProjectionMatrix * uViewMatrix * uModelMatrix *    vec4("+a+", 1.0);"};OMEGA.Omega3D.Shaders.Components.Vertex_View_Conversion_V3=function(b,a){return b+" = uProjectionMatrix * uViewMatrix * uModelMatrix *    vec4("+a+", 1.0);"};OMEGA.Omega3D.Shaders.Components.Vertex_ScreenSpace_Conversion_V3=function(b,a){return b+" = vec4("+a+", 1.0);"};OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic=function(a){return"gl_FragColor = "+a+";"};OMEGA.Omega3D.Shaders.Components.Noise3D=function(){var a="vec3 mod289(vec3 x) {return x - floor(x * (1.0 / 289.0)) * 289.0;}vec4 mod289(vec4 x) {return x - floor(x * (1.0 / 289.0)) * 289.0;}vec4 permute(vec4 x) {return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}float pnoise(vec3 P, vec3 rep){    vec3 Pi0 = mod(floor(P), rep);    vec3 Pi1 = mod(Pi0 + vec3(1.0), rep);    Pi0 = mod289(Pi0);    Pi1 = mod289(Pi1);    vec3 Pf0 = fract(P);    vec3 Pf1 = Pf0 - vec3(1.0);    vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);    vec4 iy = vec4(Pi0.yy, Pi1.yy);   vec4 iz0 = Pi0.zzzz;   vec4 iz1 = Pi1.zzzz;    vec4 ixy = permute(permute(ix) + iy);    vec4 ixy0 = permute(ixy + iz0);    vec4 ixy1 = permute(ixy + iz1);    vec4 gx0 = ixy0 * (1.0 / 7.0);    vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;    gx0 = fract(gx0);    vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);     vec4 sz0 = step(gz0, vec4(0.0));    gx0 -= sz0 * (step(0.0, gx0) - 0.5);    gy0 -= sz0 * (step(0.0, gy0) - 0.5);    vec4 gx1 = ixy1 * (1.0 / 7.0);    vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;    gx1 = fract(gx1);    vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);    vec4 sz1 = step(gz1, vec4(0.0));    gx1 -= sz1 * (step(0.0, gx1) - 0.5);    gy1 -= sz1 * (step(0.0, gy1) - 0.5);    vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);    vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);    vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);    vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);   vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);    vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);    vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);   vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);    vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));    g000 *= norm0.x;   g010 *= norm0.y;    g100 *= norm0.z;   g110 *= norm0.w;    vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));    g001 *= norm1.x;    g011 *= norm1.y;   g101 *= norm1.z;   g111 *= norm1.w;    float n000 = dot(g000, Pf0);    float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));    float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));   float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));    float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));    float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));    float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));    float n111 = dot(g111, Pf1);    vec3 fade_xyz = fade(Pf0);    vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);    vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);    float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);    return 2.2 * n_xyz;}";return a};OMEGA.Omega3D.Shaders.Components.Basic_Light_Includes=function(){var a="uniform vec3 uLightPosition;uniform vec3 uLightDirection;uniform vec3 uAmbientColor;uniform vec3 uDiffuseColor;uniform vec3 uSpecularColor;";return a};OMEGA.Omega3D.Shaders.Components.Basic_Light_Varying=function(){var a="varying vec3 vNormalEye;varying vec4 vPositionEye4;";return a};OMEGA.Omega3D.Shaders.Components.Basic_Diffuse_Vertex_Logic=function(){var a="vPositionEye4 = gl_Position;vec3 temp = uNormalMatrix *aVertexNormal;vNormalEye = normalize(temp);";return a};OMEGA.Omega3D.Shaders.Components.Basic_Diffuse_Fragment_Logic=function(b){var a="vec3 vectorToLightSource    = normalize(uLightPosition.xyz-vPositionEye4.xyz );float diffuseLightWeighting = max(dot(vNormalEye, vectorToLightSource), 0.0);vec3 lightWeighting = uAmbientColor + uDiffuseColor * diffuseLightWeighting;vec4 texelColor = "+b+"gl_FragColor = vec4( lightWeighting.rgb * texelColor.rgb, texelColor.a);";return a};OMEGA.Omega3D.Shaders.Components.Basic_Phong_Fragment_Logic=function(b){var a="vec3 vectorToLightSource    = normalize(uLightPosition.xyz-vPositionEye4.xyz );float diffuseLightWeighting = max(dot(vNormalEye, vectorToLightSource), 0.0);vec3 reflectionVector       = normalize(reflect(-vectorToLightSource, vNormalEye));vec3 viewVectorEye  = normalize(vPositionEye4.xyz);float rdotv  = max(dot(reflectionVector, viewVectorEye), 0.0);float specularLightWeighting = pow(rdotv, 8.0);vec3 lightWeighting = uAmbientColor + uDiffuseColor * diffuseLightWeighting + uSpecularColor * specularLightWeighting;vec4 texelColor = "+b+"gl_FragColor = vec4( lightWeighting.rgb * texelColor.rgb, texelColor.a);";return a};OMEGA.Omega3D.Shaders.Components.StandardAttributes=function(){var a={};a.aTextureCoord={type:"vec2",glsl:"attribute vec2 aTextureCoord;",value:null};a.aVertexPos={type:"vec3",glsl:"attribute vec3 aVertexPos;",value:null};a.aVertexNormal={type:"vec3",glsl:"attribute vec3 aVertexNormal;",value:null};a.aVertexTangent={type:"vec3",glsl:"attribute vec3 aVertexTangent;",value:null};a.aVertexBitangent={type:"vec3",glsl:"attribute vec3 aVertexBitangent;",value:null};a.aVertexColor={type:"vec3",glsl:"attribute vec3 aVertexColor;",value:null};a.aPickingColor={type:"vec3",glsl:"attribute vec3 aPickingColor;",value:null};return a};OMEGA.Omega3D.Shaders.Components.StandardUniforms=function(){var a={};a.uDiffuse={type:"vec3",glsl:"uniform mat4 uDiffuse;",value:null};a.uAmbient={type:"vec3",glsl:"uniform mat4 uAmbient;",value:null};a.uSpecular={type:"vec3",glsl:"uniform mat4 uSpecular;",value:null};a.uModelMatrix={type:"mat4",glsl:"uniform mat4 uModelMatrix;",value:null};a.uProjectionMatrix={type:"mat4",glsl:"uniform mat4 uProjectionMatrix;",value:null};a.uViewMatrix={type:"mat4",glsl:"uniform mat4 uViewMatrix;",value:null};a.uInvViewMatrix={type:"mat4",glsl:"uniform mat4 uInvViewMatrix;",value:null};a.uNormalMatrix={type:"mat3",glsl:"uniform mat3 uNormalMatrix;",value:null};a.uCamPos={type:"vec3",glsl:"uniform vec3 uCamPos;",value:null};return a};OMEGA.Omega3D.Shaders.Components.StandardLightUniforms=function(){var a={};a.uLightPosition={type:"vec3",glsl:"uniform vec3 uLightPosition;",value:null};a.uLightDirection={type:"vec3",glsl:"uniform vec3 uLightDirection;",value:null};return a};function Shader(b,a,c){this.vars=c;this.vertex_shader_src=b;this.fragment_shader_src=a;this.GetVertexShaderSource=function(){return this.vertex_shader_src};this.GetFragmentShaderSource=function(){return this.fragment_shader_src};this.GetVertexShader=function(){return this.vertex_shader};this.GetFragmentShader=function(){return this.fragment_shader};this.GetProgram=function(){return this.program};this.Enable=function(){if(!this.program){return}this.gl_context.useProgram(this.program)};this.Disable=function(){if(!this.program){return}this.gl_context.useProgram(null)};this.createProgram=function(){if(this.vertex_shader==null||this.fragment_shader==null){return}this.program=this.gl_context.createProgram();this.gl_context.attachShader(this.program,this.vertex_shader);this.gl_context.attachShader(this.program,this.fragment_shader);this.gl_context.linkProgram(this.program);if(!this.gl_context.getProgramParameter(this.program,this.gl_context.LINK_STATUS)){OMEGA.Omega3D.Log("   -- Could not initialize shaders / program");return null}if(c){for(var e in c){for(var d in c[e]){if(e==0||e==4){this.program[d]=this.gl_context.getAttribLocation(this.program,d.toString())}else{this.program[d]=this.gl_context.getUniformLocation(this.program,d.toString())}}}}this.gl_context.validateProgram(this.program);if(!this.gl_context.getProgramParameter(this.program,this.gl_context.VALIDATE_STATUS)){OMEGA.Omega3D.Log("   -- Program validation failed!");return null}this.gl_context.detachShader(this.program,this.vertex_shader);this.gl_context.detachShader(this.program,this.fragment_shader);this.gl_context.deleteShader(this.vertex_shader);this.gl_context.deleteShader(this.fragment_shader);return this.program};this.createShaderElement=function(f,h){if(!h){return null}var g=this.gl_context.createShader(f);this.gl_context.shaderSource(g,h);this.gl_context.compileShader(g);if(!this.gl_context.getShaderParameter(g,this.gl_context.COMPILE_STATUS)){OMEGA.Omega3D.Log((f==this.gl_context.VERTEX_SHADER?"  -- Vertex component: ":"   -- Fragment component: ")+this.gl_context.getShaderInfoLog(g));var d=h.split("\n");for(var e in d){OMEGA.Omega3D.Log(e,d[e])}return null}return g};this.GetSamplerLocation=function(f){for(var e in c){for(var d in c[e]){if(c[e][d].type=="sampler2D"||c[e][d].type=="samplerCube"){if(f!=null){if(f==d){return this.program[d]}}else{return this.program[d]}}}}return -1};this.Clone=function(){return new OMEGA.Omega3D.Shader(this.vertex_shader_src,this.fragment_shader_src,this.vars)};this.gl_context=OMEGA.Omega3D.GL;this.vertex_shader=this.gl_context?this.createShaderElement(this.gl_context.VERTEX_SHADER,this.vertex_shader_src):null;this.fragment_shader=this.gl_context?this.createShaderElement(this.gl_context.FRAGMENT_SHADER,this.fragment_shader_src):null;this.program=this.gl_context?this.createProgram():null}OMEGA.Omega3D.Shader=Shader;OMEGA.Omega3D.Shaders=OMEGA.Omega3D.Shaders||{};OMEGA.Omega3D.Shaders.Basic=function(b,f,d){var h,e;b=b||false;if(b){h="varying vec2 vTexCoord;"}else{h=""}var c=OMEGA.Omega3D.Shaders.Components.Basic_Includes();c=c+h;c=c+"void main(void){ gl_PointSize = 10.0;";c=c+OMEGA.Omega3D.Shaders.Components.Vertex_World_Conversion_V3("gl_Position","aVertexPos");if(b){c=c+OMEGA.Omega3D.Shaders.Components.Basic_TextureCoords("vTexCoord")}c=c+"}";if(b){h="uniform sampler2D uSampler;varying vec2 vTexCoord;";e="texture2D(uSampler, vec2(vTexCoord.s, vTexCoord.t));"}else{if(d){e="vec4("+d[0]+","+ +d[1]+","+ +d[2]+", 1.0);"}else{e="vec4(0.8,0.4,0.0, 1.0);"}}var a=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float();a=a+OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes();if(b){a=a+h}a=a+"void main(void){";a=a+"vec4 color = "+e;a=a+OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic("vec4(color.rgb, color.a)");a=a+"}";var j=OMEGA.Omega3D.Shaders.Components.StandardUniforms();if(f!=null){var g=OMEGA.Omega3D.ShaderUtil.InjectGLSLForLights(c,a,j,f);j=g.uniforms;c=g.vs;a=g.fs;if(f.hasFog){g=OMEGA.Omega3D.ShaderUtil.InjectGLSLForFog(c,a,j,f);j=g.uniforms;c=g.vs;a=g.fs}}var i={};if(b){i.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null}}return new OMEGA.Omega3D.Shader(c,a,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),j,{},i])};OMEGA.Omega3D.Shaders.CubeMap=function(c){var e=OMEGA.Omega3D.Shaders.Components.Basic_Includes()+"varying vec3 vTexCoord;void main(void){"+OMEGA.Omega3D.Shaders.Components.Vertex_View_Conversion_V3("gl_Position","aVertexPos")+"vTexCoord = (vec4(aVertexPos, 0.0)).xyz;}";var b=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float()+OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes()+"uniform samplerCube uSampler;varying vec3 vTexCoord;void main(void){gl_FragColor = textureCube(uSampler, vTexCoord);}";var a=OMEGA.Omega3D.Shaders.Components.StandardUniforms();var d={};d.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null};return new OMEGA.Omega3D.Shader(e,b,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),a,{},d])};OMEGA.Omega3D.Shaders.SkyBox=function(c){var e=[OMEGA.Omega3D.Shaders.Components.Basic_Includes(),"varying vec3 vTexCoord;","void main(void){","mat4 viewMatrix = mat4(mat3(uViewMatrix));","gl_Position = uProjectionMatrix * viewMatrix * uModelMatrix * vec4(aVertexPos, 1.0);","vTexCoord   = (vec4(aVertexPos, 0.0)).xyz;","}"].join("\n");var b=[OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float(),OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes(),"uniform samplerCube uSampler;","varying vec3 vTexCoord;","void main(void){","gl_FragColor = textureCube(uSampler, vTexCoord);","}"].join("\n");var a=OMEGA.Omega3D.Shaders.Components.StandardUniforms();var d={};d.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null};return new OMEGA.Omega3D.Shader(e,b,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),a,{},d])};OMEGA.Omega3D.Shaders.CubemapReflection=function(d){var f="attribute vec2 aTextureCoord;attribute vec3 aVertexPos;attribute vec3 aVertexNormal;uniform mat4 uModelMatrix;uniform mat4 uProjectionMatrix;uniform mat4 uViewMatrix;uniform mat4 uInvViewMatrix;uniform mat3 uNormalMatrix;varying vec3 vTexCoord;varying vec3 vColor;void main(void){   vec3 vertexWorld =  (uModelMatrix * vec4(aVertexPos, 1.0)).xyz;   vec3 normalWorld =  (uModelMatrix * vec4(aVertexNormal, 0.0)).xyz;   vec3 eyeWorld       = vec3(uInvViewMatrix[3].xyz);   vec3 vertexToEyeWorld =  normalize( vertexWorld - eyeWorld );   vTexCoord             =  normalize( reflect( vertexToEyeWorld, normalWorld ) );   gl_Position = uProjectionMatrix * uViewMatrix * uModelMatrix *vec4(aVertexPos, 1.0);}";var c=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float()+OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes()+"varying vec3 vTexCoord;uniform samplerCube uSampler;void main(void){vec4 color = textureCube(uSampler, vTexCoord);"+OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic("vec4(color.rgb, color.a)")+"}";var b;var a=OMEGA.Omega3D.Shaders.Components.StandardUniforms();if(d!=null){b=OMEGA.Omega3D.ShaderUtil.InjectGLSLForLights(f,c,a,d);a=b.uniforms;f=b.vs;c=b.fs;if(d.hasFog){b=OMEGA.Omega3D.ShaderUtil.InjectGLSLForFog(f,c,a,d);a=b.uniforms;f=b.vs;c=b.fs}}var e={};e.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null};return new OMEGA.Omega3D.Shader(f,c,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),a,{},e])};OMEGA.Omega3D.Shaders.SEM=function(d){var f=OMEGA.Omega3D.Shaders.Components.Basic_Includes();f+="varying vec3 e;";f+="varying vec3 n;";f+="void main(void){";f+="e = normalize( vec3( uViewMatrix * uModelMatrix * vec4(aVertexPos.xyz, 1.0) ) );";f+="n = normalize( uNormalMatrix * aVertexNormal );";f+=OMEGA.Omega3D.Shaders.Components.Vertex_World_Conversion_V3("gl_Position","aVertexPos");f+="}";var c=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float();c=c+OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes();c+="uniform sampler2D uSampler;";c+="varying vec3 e;";c+="varying vec3 n;";c+="void main(void){";c+="vec3 r = reflect( e, n );";c+="float m = 2.0 * sqrt( pow( r.x, 2.0) + pow( r.y, 2.0) + pow( r.z + 1.0, 2.0) );";c+="vec2 vN = r.xy / m + 0.5;";c+="vec4 color = texture2D(uSampler, vN);";c+=OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic("vec4(color.rgb, color.a)");c+="}";var a=OMEGA.Omega3D.Shaders.Components.StandardUniforms();if(d!=null){var b=OMEGA.Omega3D.ShaderUtil.InjectGLSLForLights(f,c,a,d);a=b.uniforms;f=b.vs;c=b.fs;if(d.hasFog){b=OMEGA.Omega3D.ShaderUtil.InjectGLSLForFog(f,c,a,d);a=b.uniforms;f=b.vs;c=b.fs}}var e={};e.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null};return new OMEGA.Omega3D.Shader(f,c,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),a,{},e])};OMEGA.Omega3D.Shaders.SM=function(e){var g=OMEGA.Omega3D.Shaders.Components.Basic_Includes();g+="uniform mat4 uLightM;";g+="varying vec2 vTexCoord;";g+="varying vec4 vertexPosLight;";g+="void main(void){";g+="mat4 mvp       = uProjectionMatrix * uViewMatrix * uModelMatrix;";g+="mat4 mvp_light = uProjectionMatrix * uLightM * uModelMatrix;";g+="vec4 pos       = mvp * vec4(aVertexPos.xyz, 1.0);";g+="vertexPosLight = mvp_light * vec4(aVertexPos.xyz, 1.0);";g+="gl_Position    = pos;";g+="vTexCoord      = aTextureCoord;";g+="}";var d=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float();d=d+OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes();d+="uniform sampler2D uSampler;";d+="uniform sampler2D uSampler_1;";d+="varying vec2 vTexCoord;";d+="varying vec4 vertexPosLight;";d+="void main(void){";d+="vec3 nLightPos   = (vertexPosLight.xyz / vertexPosLight.w) / 2.0 + 0.5;";d+="vec4 depth       = texture2D(uSampler_1, vec2(nLightPos.xy));";d+="vec4 texture     = texture2D(uSampler, vec2(vTexCoord.st));";d+="float bias       = 0.0000000001;";d+="float visibility = 1.0;";d+="float notInSight = 0.0;";d+="float divider = 500.0*depth.r;";d+="if ( texture2D( uSampler_1, nLightPos.xy/divider ).r == notInSight  ){}";d+="else{";d+="if ( texture2D( uSampler_1, nLightPos.xy ).r   + bias <  nLightPos.z  ){ visibility-=0.05; }";d+="if ( texture2D( uSampler_1, nLightPos.xy+ vec2( -0.94201624 , -0.39906216 )/divider ).r   + bias<  nLightPos.z  ){visibility-=0.1; }";d+="if ( texture2D( uSampler_1, nLightPos.xy+ vec2(  0.94558609 , -0.76890725 )/divider ).r   + bias<  nLightPos.z  ){ visibility-=0.1; }";d+="if ( texture2D( uSampler_1, nLightPos.xy+ vec2( -0.094184101, -0.92938870 )/divider ).r   + bias<  nLightPos.z  ){ visibility-=0.1; }";d+="if ( texture2D( uSampler_1, nLightPos.xy+ vec2(  0.34495938 ,  0.29387760 )/divider ).r   + bias<  nLightPos.z  ){ visibility-=0.1; }}";d+="vec4 color       = vec4( texture.rgb*visibility, 1.0);";d+=OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic("vec4(color.rgb, color.a)");d+="}";var a=OMEGA.Omega3D.Shaders.Components.StandardUniforms();if(e!=null){var c=OMEGA.Omega3D.ShaderUtil.InjectGLSLForLights(g,d,a,e);a=c.uniforms;g=c.vs;d=c.fs;if(e.hasFog){c=OMEGA.Omega3D.ShaderUtil.InjectGLSLForFog(g,d,a,e);a=c.uniforms;g=c.vs;d=c.fs}}var f={};f.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null};f.uSampler_1={id:"uSampler_1",type:"sampler2D",glsl:"",value:null};var b={};b.uLightM={type:"mat4",glsl:"",value:""};return new OMEGA.Omega3D.Shader(g,d,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),a,b,f])};OMEGA.Omega3D.Shaders.DepthMap=function(){var c=[OMEGA.Omega3D.Shaders.Components.Basic_Includes(),"varying vec4 vPos;","void main(void){","gl_Position    = uProjectionMatrix * uViewMatrix * uModelMatrix * vec4(aVertexPos.xyz, 1.0);","vPos           = gl_Position;","}"].join("\n");var b=["#extension GL_OES_standard_derivatives : enable",OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float(),OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes(),"varying vec4 vPos;","vec2 packHalf( float depth ){","const vec2 bias = vec2(1.0 / 255.0, 0.0);","vec2 colour = vec2(depth, fract(depth * 255.0));","return colour - (colour.yy * bias);","}","void main(void){","float depth = vPos.z/ vPos.w;","depth   = depth * 0.5 + 0.5;","float moment1 = depth;","float dx = dFdx(depth);","float dy = dFdy(depth);","float moment2 = (depth * depth) + 0.25 * (dx*dx+dy*dy);","gl_FragColor = vec4( moment1, moment2, 0.0, 1.0);","}"].join("\n");var a=OMEGA.Omega3D.Shaders.Components.StandardUniforms();return new OMEGA.Omega3D.Shader(c,b,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),a,{},{}])};OMEGA.Omega3D.Shaders.VSM=function(e){var g=[OMEGA.Omega3D.Shaders.Components.Basic_Includes(),"uniform mat4 uLightM;","varying vec2 vTexCoord;","varying vec4 vertexPosLight;","void main(void){","mat4 mvp       = uProjectionMatrix * uViewMatrix * uModelMatrix;","mat4 mvp_light = uProjectionMatrix * uLightM * uModelMatrix;","vec4 pos       = mvp * vec4(aVertexPos.xyz, 1.0);","vertexPosLight = mvp_light * vec4(aVertexPos.xyz, 1.0);","gl_Position    = pos;","vTexCoord      = aTextureCoord;","}"].join("\n");var b=[OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float(),OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes(),"uniform sampler2D uSampler;","uniform sampler2D uSampler_1;","varying vec2 vTexCoord;","varying vec4 vertexPosLight;","float unpackHalf (vec2 color){","return color.x + (color.y / 255.0);","}","float linestep(float low,  float v){","return clamp((v-low)/(1.0-low), 0.0, 1.0);","}","float ChebyshevUpperBound( vec2 moments, float t ){","float min_variance = 0.001;","if(t <= moments.x) return 1.0;","float p = smoothstep(t-min_variance, t, moments.x);","float variance = max( moments.y - moments.x * moments.x, min_variance );","float d = t -moments.y;","float p_max = linestep( 0.1, variance / (variance + d*d));","return min(1.0, max(p, p_max));","}","float ShadowContribution( vec2 lightTexCoord, float DistanceToLight){","vec2 moments =  texture2D( uSampler_1, lightTexCoord).rg;","return ChebyshevUpperBound( moments, DistanceToLight);","}","void main(void){","vec3 nLightPos = (vertexPosLight.xyz / vertexPosLight.w)* 0.5 + 0.5;","float shadow = ShadowContribution( vec2(nLightPos.xy), nLightPos.z);","vec4 texture = texture2D(uSampler, vec2(vTexCoord.st));","vec4 color = vec4(shadow, shadow, shadow, 1.0) *texture;",OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic("vec4(color.rgb, color.a)"),"}"].join("\n");var a=OMEGA.Omega3D.Shaders.Components.StandardUniforms();if(e!=null){var d=OMEGA.Omega3D.ShaderUtil.InjectGLSLForLights(g,b,a,e);a=d.uniforms;g=d.vs;b=d.fs;if(e.hasFog){d=OMEGA.Omega3D.ShaderUtil.InjectGLSLForFog(g,b,a,e);a=d.uniforms;g=d.vs;b=d.fs}}var f={};f.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null};f.uSampler_1={id:"uSampler_1",type:"sampler2D",glsl:"",value:null};var c={};c.uLightM={type:"mat4",glsl:"",value:""};return new OMEGA.Omega3D.Shader(g,b,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),a,c,f])};OMEGA.Omega3D.Shaders.ColorPicking=function(){var d=OMEGA.Omega3D.Shaders.Components.Basic_Includes();d=d+"varying vec3 vPickingColor;";d=d+"void main(void){";d=d+"vPickingColor = aPickingColor;";d=d+OMEGA.Omega3D.Shaders.Components.Vertex_World_Conversion_V3("gl_Position","aVertexPos");d=d+"}";var b=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float();b=b+"varying vec3 vPickingColor;";b=b+"void main(void){";b=b+"vec4 color = vec4(vPickingColor.r,0, 0, 1.0);";b=b+OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic("vec4(color.rgb, color.a)");b=b+"}";var a=OMEGA.Omega3D.Shaders.Components.StandardUniforms();var c={};return new OMEGA.Omega3D.Shader(d,b,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),a,{},c])};OMEGA.Omega3D.Shaders.BumpMapping=function(d){var f=[OMEGA.Omega3D.Shaders.Components.Basic_Includes(),"varying vec2 vTexCoord;","void main(void){","mat4 mvp       = uProjectionMatrix * uViewMatrix * uModelMatrix;","vec4 pos       = mvp * vec4(aVertexPos.xyz, 1.0);","gl_Position    = pos;","vTexCoord      = aTextureCoord;","}"].join("\n");var b=[OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float(),OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes(),"uniform sampler2D uSampler;","uniform sampler2D uSampler_1;","varying vec2 vTexCoord;","void main(void){","vec3 texture        = texture2D(uSampler  , vec2(vTexCoord.st)).rgb;","vec3 texture_normal = texture2D(uSampler_1, vec2(vTexCoord.st)).rgb;","texture_normal = normalize(texture_normal* 2.0 - 1.0);;","vec4 color = texture_normal;",OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic("vec4(color.rgb, color.a)"),"}"].join("\n");var a=OMEGA.Omega3D.Shaders.Components.StandardUniforms();var e={};e.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null};e.uSampler_1={id:"uSampler_1",type:"sampler2D",glsl:"",value:null};var c={};return new OMEGA.Omega3D.Shader(f,b,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),a,c,e])};OMEGA.Omega3D.Shaders.FresnelRim=function(f,e){e=e||{scale:"1.0",power:"1.0",minimum:"0.0",color:"1.0, 1.0, 1.0"};var h=[OMEGA.Omega3D.Shaders.Components.Basic_Includes(),"varying vec2 vTexCoord;","varying vec3 vNormal;","varying float vRatio;","void main(void){","vec3 posWorld  = vec3( uModelMatrix * vec4(aVertexPos, 1.0)).xyz;","gl_Position = uProjectionMatrix * uViewMatrix * vec4(posWorld, 1.0);",OMEGA.Omega3D.Shaders.Components.Basic_TextureCoords("vTexCoord"),"vec3 vNormal = normalize(mat3(uModelMatrix) * aVertexNormal );","vec3 I = normalize( uCamPos - posWorld);","float MINIMUM = "+e.minimum+";","float SCALE = "+e.scale+";","float POWER = "+e.power+";","vRatio = MINIMUM + SCALE * pow(1.0 + dot(I, vNormal), POWER);","}"].join("\n");var b=[OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float(),OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes(),"uniform sampler2D uSampler;","varying vec2 vTexCoord;","varying float vRatio;","void main(void){","vec4 RIM_COLOR = vec4("+e.color+", 1.0);","vec4 c     = texture2D( uSampler, vTexCoord.st);","vec4 color = mix( c, RIM_COLOR, vRatio);",OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic("vec4(color.rgb, color.a)"),"}"].join("\n");var a=OMEGA.Omega3D.Shaders.Components.StandardUniforms();if(f!=null){var d=OMEGA.Omega3D.ShaderUtil.InjectGLSLForLights(h,b,a,f);a=d.uniforms;h=d.vs;b=d.fs;if(f.hasFog){d=OMEGA.Omega3D.ShaderUtil.InjectGLSLForFog(h,b,a,f);a=d.uniforms;h=d.vs;b=d.fs}}var g={};g.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null};var c={};return new OMEGA.Omega3D.Shader(h,b,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),a,c,g])};OMEGA.Omega3D.Shaders.FresnelReflection=function(e,d){d=d||{scale:"1.0",power:"1.0",minimum:"0.0",color:"1.0, 1.0, 1.0"};var g=[OMEGA.Omega3D.Shaders.Components.Basic_Includes(),"varying vec2 vTexCoord;","varying vec3 vTexCoordCubeMap;","varying float vRatio;","void main(void){","vec3 posWorld  = vec3( uModelMatrix * vec4(aVertexPos, 1.0)).xyz;","vec3 worldNormal = normalize(mat3(uModelMatrix) * aVertexNormal );","vec3 vertexToCamWorld = normalize( uCamPos - posWorld);","gl_Position = uProjectionMatrix * uViewMatrix * vec4(posWorld, 1.0);",OMEGA.Omega3D.Shaders.Components.Basic_TextureCoords("vTexCoord"),"vTexCoordCubeMap =  normalize( reflect( -vertexToCamWorld, worldNormal ) );float MINIMUM = "+d.minimum+";","float SCALE = "+d.scale+";","float POWER =  "+d.power+";","vRatio      = MINIMUM + SCALE * pow(1.0 + dot(vertexToCamWorld, worldNormal), POWER);","}"].join("\n");var b=[OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float(),OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes(),"uniform samplerCube uSampler;","uniform sampler2D uSampler_1;","varying vec2 vTexCoord;","varying vec3 vTexCoordCubeMap;","varying float vRatio;","void main(void){","vec4 c     =  texture2D  ( uSampler_1, vTexCoord.st    );","vec4 cm    = textureCube( uSampler  , vTexCoordCubeMap);","vec4 color = mix( c, cm, vRatio);",OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic("vec4(color.rgb, color.a)"),"}"].join("\n");var a=OMEGA.Omega3D.Shaders.Components.StandardUniforms();if(e!=null){var c=OMEGA.Omega3D.ShaderUtil.InjectGLSLForLights(g,b,a,e);a=c.uniforms;g=c.vs;b=c.fs;if(e.hasFog){c=OMEGA.Omega3D.ShaderUtil.InjectGLSLForFog(g,b,a,e);a=c.uniforms;g=c.vs;b=c.fs}}var f={};f.uSampler={id:"uSampler",type:"samplerCube",glsl:"",value:null};f.uSampler_1={id:"uSampler_1",type:"sampler2D",glsl:"",value:null};return new OMEGA.Omega3D.Shader(g,b,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),a,{},f])};OMEGA.Omega3D.Shaders.PostProcessing=function(b,f,d){var g,e;b=b||false;if(b){g="varying vec2 vTexCoord;"}else{g=""}var c=OMEGA.Omega3D.Shaders.Components.Basic_Includes();c=c+g;c=c+"void main(void){";c=c+OMEGA.Omega3D.Shaders.Components.Vertex_ScreenSpace_Conversion_V3("gl_Position","aVertexPos");if(b){c=c+OMEGA.Omega3D.Shaders.Components.Basic_TextureCoords("vTexCoord")}c=c+"}";if(b){g="uniform sampler2D uSampler;varying vec2 vTexCoord;";e="texture2D(uSampler, vec2(1.0-vTexCoord.s, 1.0 - vTexCoord.t));"}else{if(d){e="vec4("+d[0]+","+ +d[1]+","+ +d[2]+", 1.0);"}else{e="vec4(0.8,0.4,0.0, 1.0);"}}var a=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float();if(b){a=a+OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes();a=a+g}a=a+"void main(void){";a=a+"vec4 color = "+e;a=a+OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic("vec4(color.rgb, color.a)");a=a+"}";var i=OMEGA.Omega3D.Shaders.Components.StandardUniforms();var h={};if(b){h.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null}}return new OMEGA.Omega3D.Shader(c,a,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),i,{},h])};OMEGA.Omega3D.Shaders.ExposureToneMapping=function(){var d=[OMEGA.Omega3D.Shaders.Components.Basic_Includes(),"varying vec2 vTexCoord;","void main(void){","mat4 mvp       = uProjectionMatrix * uViewMatrix * uModelMatrix;","vec4 pos       = vec4(aVertexPos.xyz, 1.0);","gl_Position    = pos;",OMEGA.Omega3D.Shaders.Components.Basic_TextureCoords("vTexCoord"),"}"].join("\n");var b=[OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float(),OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes(),"uniform sampler2D uSampler;","varying vec2 vTexCoord;","void main(void){","float gamma = 2.2;","float exposure = 0.5;","vec3 hdrColor = texture2D(uSampler, vTexCoord ).rgb;","vec3 mapped = hdrColor / (hdrColor + vec3(1.0));","vec4 color = vec4(mapped, 1.0);",OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic("vec4(color.rgb, color.a)"),"}"].join("\n");var a=OMEGA.Omega3D.Shaders.Components.StandardUniforms();var c={};c.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null};return new OMEGA.Omega3D.Shader(d,b,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),a,{},c])};OMEGA.Omega3D.Shaders.BloomMap=function(c){var e=[OMEGA.Omega3D.Shaders.Components.Basic_Includes(),"varying vec2 vTexCoord;","void main(void){","mat4 mvp       = uProjectionMatrix * uViewMatrix * uModelMatrix;","vec4 pos       = vec4(aVertexPos.xyz, 1.0);","gl_Position    = pos;",OMEGA.Omega3D.Shaders.Components.Basic_TextureCoords("vTexCoord"),"}"].join("\n");var b=[OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float(),OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes(),"uniform sampler2D uSampler;","varying vec2 vTexCoord;","void main(void){","vec4 color = vec4(vec3(0), 1.0);","vec4 fragcolor = texture2D(uSampler, vTexCoord );","float brightness = dot( fragcolor.rgb, vec3( 0.2126, 0.7152, 0.0722));","if(brightness > "+c.toFixed(2).toString()+"){","color = vec4( fragcolor.rgb, 1.0);","}",OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic("vec4(color.rgb, color.a)"),"}"].join("\n");var a=OMEGA.Omega3D.Shaders.Components.StandardUniforms();var d={};d.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null};return new OMEGA.Omega3D.Shader(e,b,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),a,{},d])};OMEGA.Omega3D.Shaders.TextureBlend=function(){var d=[OMEGA.Omega3D.Shaders.Components.Basic_Includes(),"varying vec2 vTexCoord;","void main(void){","mat4 mvp       = uProjectionMatrix * uViewMatrix * uModelMatrix;","vec4 pos       = vec4(aVertexPos.xyz, 1.0);","gl_Position    = pos;",OMEGA.Omega3D.Shaders.Components.Basic_TextureCoords("vTexCoord"),"}"].join("\n");var b=[OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float(),OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes(),"uniform sampler2D uSampler;","uniform sampler2D uSampler_1;","varying vec2 vTexCoord;","void main(void){","float gamma = 2.2;","float exposure = 2.0;","vec3 colorA   = texture2D(uSampler, vTexCoord ).rgb;","vec3 colorB   = texture2D(uSampler_1, vec2(vTexCoord.s,vTexCoord.t)  ).rgb;","colorA += colorB;","vec3 result = vec3(1.0) - exp(-colorA * exposure);","vec4 color = vec4(colorA, 1.0);",OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic("vec4(color.rgb, color.a)"),"}"].join("\n");var a=OMEGA.Omega3D.Shaders.Components.StandardUniforms();var c={};c.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null};c.uSampler_1={id:"uSampler_1",type:"sampler2D",glsl:"",value:null};return new OMEGA.Omega3D.Shader(d,b,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),a,{},c])};OMEGA.Omega3D.Shaders.DownSample=function(){var d=[OMEGA.Omega3D.Shaders.Components.Basic_Includes(),"varying vec2 vTexCoord;","void main(void){","mat4 mvp       = uProjectionMatrix * uViewMatrix * uModelMatrix;","vec4 pos       = vec4(aVertexPos.xyz, 1.0);","gl_Position    = pos;",OMEGA.Omega3D.Shaders.Components.Basic_TextureCoords("vTexCoord"),"}"].join("\n");var b=[OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float(),OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes(),"uniform sampler2D uSampler;","varying vec2 vTexCoord;","void main(void){","vec4 color = texture2D(uSampler, vec2(1.0, 1.0) - vTexCoord );",OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic("vec4(color.rgb, color.a)"),"}"].join("\n");var a=OMEGA.Omega3D.Shaders.Components.StandardUniforms();var c={};c.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null};return new OMEGA.Omega3D.Shader(d,b,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),a,{},c])};OMEGA.Omega3D.Shaders.DirectionalBlur=function(d,c){var f=[OMEGA.Omega3D.Shaders.Components.Basic_Includes(),"varying vec2 vTexCoord;","void main(void){","mat4 mvp       = uProjectionMatrix * uViewMatrix * uModelMatrix;","vec4 pos       = vec4(aVertexPos.xyz, 1.0);","gl_Position    = pos;",OMEGA.Omega3D.Shaders.Components.Basic_TextureCoords("vTexCoord"),"}"].join("\n");var b=[OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float(),OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes(),"uniform sampler2D uSampler;","varying vec2 vTexCoord;","float weight[5];","void main(void){","weight[0] = 0.227027;","weight[1] = 0.1945946;","weight[2] = 0.1216216;","weight[3] = 0.054054;","weight[4] = 0.016216;","vec4 color      = vec4(vec3(0), 1.0);","vec2 tex_offset = vec2(1.0 / "+c.toFixed(1).toString()+");","vec3 result     = texture2D( uSampler, vTexCoord).rgb * weight[0];","float t = 1.0;","if("+d+" == 1){","for(int i = 1; i < 5; ++i){","result += texture2D(uSampler, vTexCoord + vec2( tex_offset.x * t, 0.0)).rgb * weight[i];","result += texture2D(uSampler, vTexCoord - vec2( tex_offset.x * t, 0.0)).rgb * weight[i];","t += 1.0;","}","}else{","for(int i = 1; i < 5; ++i){","result += texture2D(uSampler, vTexCoord + vec2( 0.0, tex_offset.y * t)).rgb * weight[i];","result += texture2D(uSampler, vTexCoord - vec2( 0.0, tex_offset.y * t)).rgb * weight[i];","t += 1.0;","}","}","color = vec4(result, 1.0);",OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic("vec4(color.rgb, color.a)"),"}"].join("\n");var a=OMEGA.Omega3D.Shaders.Components.StandardUniforms();var e={};e.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null};return new OMEGA.Omega3D.Shader(f,b,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),a,{},e])};OMEGA.Omega3D.Shaders.PP_ColorMultiply=function(g){var d,c;d="varying vec2 vTexCoord;";var f=OMEGA.Omega3D.Shaders.Components.Basic_Includes();f=f+d;f=f+"void main(void){";f=f+OMEGA.Omega3D.Shaders.Components.Vertex_ScreenSpace_Conversion_V3("gl_Position","aVertexPos");f=f+OMEGA.Omega3D.Shaders.Components.Basic_TextureCoords("vTexCoord");f=f+"}";d="uniform sampler2D uSampler;varying vec2 vTexCoord;";var b=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float();b=b+OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes();b=b+d;b=b+"void main(void){";b=b+"vec4 color = texture2D(uSampler, vec2(vTexCoord.s, vTexCoord.t));";b=b+OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic("vec4(color.rgb*"+g+", color.a)");b=b+"}";var a=OMEGA.Omega3D.Shaders.Components.StandardUniforms();var e={};e.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null};return new OMEGA.Omega3D.Shader(f,b,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),a,{},e])};OMEGA.Omega3D.Shaders.PP_Blur=function(){var d=[OMEGA.Omega3D.Shaders.Components.Basic_Includes(),"varying vec2 vTexCoord;","void main(void){","mat4 mvp       = uProjectionMatrix * uViewMatrix * uModelMatrix;","vec4 pos       = vec4(aVertexPos.xyz, 1.0);","gl_Position    = pos;","vTexCoord      = vec2(1.0, 1.0) - aTextureCoord;","}"].join("\n");var b=[OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float(),OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes(),"uniform sampler2D uSampler;","varying vec2 vTexCoord;","void main(void){","vec4 color = vec4(0);","if ( Orientation == 0 ){","for (int i = 0; i &lt; 10; ++i){","if ( i &gt;= BlurAmount ) break;","float offset = float(i) - halfBlur;","color += texture2D(Sample0, vUv + vec2(offset * TexelSize.x, 0.0))","}","}else{","for (int i = 0; i &lt; 10; ++i){","if ( i &gt;= BlurAmount )break;","float offset = float(i) - halfBlur;","color += texture2D(Sample0, vUv + vec2(0.0, offset * TexelSize.y));","}","}","color = color / float(BlurAmount);",OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic("vec4(color.rgb, color.a)"),"}"].join("\n");var a=OMEGA.Omega3D.Shaders.Components.StandardUniforms();var c={};c.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null};return new OMEGA.Omega3D.Shader(d,b,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),a,{},c])};OMEGA.Omega3D.Shaders.Gausian_Blur=function(c){var e=[OMEGA.Omega3D.Shaders.Components.Basic_Includes(),"void main(void){","mat4 mvp       = uProjectionMatrix * uViewMatrix * uModelMatrix;","vec4 pos       = vec4(aVertexPos.xyz, 1.0);","gl_Position    = pos;","}"].join("\n");var b=[OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float(),OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes(),"uniform sampler2D uSampler;","float normpdf(in float x, in float sigma){","return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;","}","void main(void){","vec4 color = vec4(0);","const int mSize = 8;","const int kSize = (mSize-1)/2;","float kernel[mSize];","vec3 final_color = vec3(0.0);","float sigma = 8.0;","float Z = 0.0;","for (int j = 0; j <= kSize; ++j){","kernel[kSize+j] = kernel[kSize-j] = normpdf(float(j), sigma);","}","for (int j = 0; j < mSize; ++j){","Z += kernel[j];","}","vec2 uv =vec2(gl_FragCoord.xy);","for (int i=-kSize; i <= kSize; ++i){","for (int j=-kSize; j <= kSize; ++j){","vec2 newUV = (uv.xy+vec2(float(i),float(j))) / vec2( "+c.toFixed(1).toString()+", "+c.toFixed(1).toString()+");","final_color += kernel[kSize+j]*kernel[kSize+i]*texture2D(uSampler, newUV).rgb;","}","}","color = vec4(final_color/(Z*Z), 1.0);",OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic("vec4(color.rgb, color.a)"),"}"].join("\n");var a=OMEGA.Omega3D.Shaders.Components.StandardUniforms();var d={};d.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null};return new OMEGA.Omega3D.Shader(e,b,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),a,{},d])};OMEGA.Omega3D.Shaders.PP_Bloom=function(c){var e,d;e="varying vec2 vTexCoord;";var g=OMEGA.Omega3D.Shaders.Components.Basic_Includes();g=g+e;g=g+"void main(void){";g=g+OMEGA.Omega3D.Shaders.Components.Vertex_ScreenSpace_Conversion_V3("gl_Position","aVertexPos");g=g+OMEGA.Omega3D.Shaders.Components.Basic_TextureCoords("vTexCoord");g=g+"}";e="uniform sampler2D uSampler;varying vec2 vTexCoord;";c=c==null?"3":c;var b=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float();b=b+OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes();b=b+e;b=b+"void main(void){";b=b+"vec4 sum = vec4(0.0);";b=b+"vec2 tc = vec2(1.0, 1.0) - vTexCoord;";b=b+"int amount = 5;";b=b+"for( int i= -"+c+" ;i < "+c+"; i++){";b=b+"for ( int j = -"+c+"; j < "+c+"; j++){";b=b+"sum += texture2D(uSampler, tc + vec2(j, i)*0.004) * 0.25;";b=b+"}";b=b+"}";b=b+"if (texture2D(uSampler, tc).r < 0.3){";b=b+"gl_FragColor = sum*sum*0.012 + texture2D(uSampler, tc);";b=b+"}else{";b=b+"if (texture2D(uSampler, tc).r < 0.5){";b=b+"gl_FragColor = sum*sum*0.009 + texture2D(uSampler, tc);";b=b+"}else{";b=b+"gl_FragColor = sum*sum*0.0075 + texture2D(uSampler, tc);";b=b+"}}}";var a=OMEGA.Omega3D.Shaders.Components.StandardUniforms();var f={};f.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null};return new OMEGA.Omega3D.Shader(g,b,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),a,{},f])};OMEGA.Omega3D.Shaders.Diffuse=function(a){var d,c;a=a||false;if(a){d="varying vec2 vTexCoord;"}else{d=""}var f=OMEGA.Omega3D.Shaders.Components.Basic_Includes();if(OMEGA.Omega3D.LIGHTS.length>0){f=f+OMEGA.Omega3D.Shaders.Components.Basic_Light_Varying()}f=f+d;f=f+"void main(void){";f=f+OMEGA.Omega3D.Shaders.Components.Vertex_World_Conversion_V3("gl_Position","aVertexPos");if(a){f=f+OMEGA.Omega3D.Shaders.Components.Basic_TextureCoords("vTexCoord")}if(OMEGA.Omega3D.LIGHTS.length>0){f=f+OMEGA.Omega3D.Shaders.Components.Basic_Diffuse_Vertex_Logic()}f=f+"}";if(a){d="uniform sampler2D uSampler;varying vec2 vTexCoord;";c="texture2D(uSampler, vec2(vTexCoord.s, vTexCoord.t));"}else{c="vec4(0.8, 0.4, 0.0, 1.0);"}var b=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float();if(OMEGA.Omega3D.LIGHTS.length>0){b=b+OMEGA.Omega3D.Shaders.Components.Basic_Light_Includes()+OMEGA.Omega3D.Shaders.Components.Basic_Light_Varying()}if(a){b=b+OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes();b=b+d}b=b+"void main(void){";if(OMEGA.Omega3D.LIGHTS.length>0){b=b+OMEGA.Omega3D.Shaders.Components.Basic_Diffuse_Fragment_Logic(c)}else{b=b+OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic(c)}b=b+"}";var e={};if(a){e.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null}}return new OMEGA.Omega3D.Shader(f,b,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),OMEGA.Omega3D.Shaders.Components.StandardUniforms(),OMEGA.Omega3D.Shaders.Components.StandardLightUniforms(),e])};OMEGA.Omega3D.Shaders.Phong=function(a){var d,c;a=a||false;if(a){d="varying vec2 vTexCoord;"}else{d=""}var f=OMEGA.Omega3D.Shaders.Components.Basic_Includes();if(OMEGA.Omega3D.LIGHTS.length>0){f=f+OMEGA.Omega3D.Shaders.Components.Basic_Light_Varying()}f=f+d;f=f+"void main(void){";f=f+OMEGA.Omega3D.Shaders.Components.Vertex_World_Conversion_V3("gl_Position","aVertexPos");if(a){f=f+OMEGA.Omega3D.Shaders.Components.Basic_TextureCoords("vTexCoord")}if(OMEGA.Omega3D.LIGHTS.length>0){f=f+OMEGA.Omega3D.Shaders.Components.Basic_Diffuse_Vertex_Logic()}f=f+"}";if(a){d="uniform sampler2D uSampler;varying vec2 vTexCoord;";c="texture2D(uSampler, vec2(vTexCoord.s, vTexCoord.t));"}else{c="vec4(0.8, 0.4, 0.0, 1.0);"}var b=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float();if(OMEGA.Omega3D.LIGHTS.length>0){b=b+OMEGA.Omega3D.Shaders.Components.Basic_Light_Includes()+OMEGA.Omega3D.Shaders.Components.Basic_Light_Varying()}if(a){b=b+OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes();b=b+d}b=b+"void main(void){";if(OMEGA.Omega3D.LIGHTS.length>0){b=b+OMEGA.Omega3D.Shaders.Components.Basic_Phong_Fragment_Logic(c)}else{b=b+OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic(c)}b=b+"}";var e={};if(a){e.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null}}return new OMEGA.Omega3D.Shader(f,b,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),OMEGA.Omega3D.Shaders.Components.StandardUniforms(),OMEGA.Omega3D.Shaders.Components.StandardLightUniforms(),e])};OMEGA.Omega3D.Shaders.Morph=function(){var d=OMEGA.Omega3D.Shaders.Components.Basic_Includes_Post_Processing()+OMEGA.Omega3D.Shaders.Components.Noise3D();if(OMEGA.Omega3D.LIGHTS.length>0){d=d+OMEGA.Omega3D.Shaders.Components.Basic_Light_Varying()}d=d+"varying float noise;float turbulence( vec3 p ) {float t = -0.5;for (float f = 1.0 ; f <= 10.0 ; f++){float power = pow( 2.0, f );t += abs( pnoise( vec3( power * p ), vec3( 10.0, 10.0, 10.0 ) ) / power );} return t;}varying float vTime;varying vec2 vTexCoord;varying vec3 vVertexNormal;void main(void){vec4 pos = uProjectionMatrix * uViewMatrix * uModelMatrix * vec4(aVertexPos.xy, 0.0, 1.0);noise = 10.0 *  -.10 * turbulence(.5*aVertexNormal + uTime * 0.025);float b = 5.0 * pnoise(0.05 * aVertexPos, vec3(100.0) );float displacement = - 1.5 * noise + b;vec3 newPos = aVertexPos + aVertexNormal * displacement;vVertexNormal = abs(aVertexNormal * displacement);gl_Position = uProjectionMatrix * uViewMatrix * uModelMatrix *vec4(newPos, 1.0);vTexCoord = aTextureCoord;vTime = uTime;";if(OMEGA.Omega3D.LIGHTS.length>0){d=d+OMEGA.Omega3D.Shaders.Components.Basic_Diffuse_Vertex_Logic()}d=d+"}";var a=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float()+OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes();if(OMEGA.Omega3D.LIGHTS.length>0){a=a+OMEGA.Omega3D.Shaders.Components.Basic_Light_Includes()+OMEGA.Omega3D.Shaders.Components.Basic_Light_Varying()}a=a+"uniform sampler2D uSampler;varying float vTime;varying vec2 vTexCoord;varying float noise;void main(void){float n = noise;if(noise < 0.05)n = 0.05;if(noise > 0.4)n = 0.4;float ypos = 1.0-1.3*n;if(ypos < 0.0) ypos = 0.0;vec2 tPos = vec2(0, ypos*1.7);";var b="texture2D(uSampler, tPos);";if(OMEGA.Omega3D.LIGHTS.length>0){a=a+OMEGA.Omega3D.Shaders.Components.Basic_Phong_Fragment_Logic(b)}else{a=a+OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic(b)}a=a+"}";var c={};c.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null};return new OMEGA.Omega3D.Shader(d,a,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),OMEGA.Omega3D.Shaders.Components.StandardUniforms(),{},c])};OMEGA.Omega3D.Shaders.PostProcessingKernel=function(d){var c=OMEGA.Omega3D.Shaders.Components.Basic_Includes_Post_Processing()+"varying vec2 vTexCoord;void main(void){vec4 pos = uProjectionMatrix * uViewMatrix * uModelMatrix * vec4(aVertexPos.xy, 0.0, 1.0);gl_Position = pos;vTexCoord = aTextureCoord;}";var a=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float()+OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Includes()+"uniform float uKernel[9];uniform sampler2D uSampler;varying vec2 vTexCoord;void main(void){vec4 color = texture2D(uSampler, vec2(vTexCoord.s, vTexCoord.t));vec2 onePixel = vec2(1.0, 1.0) / vec2(512, 512);vec4 colorSum =texture2D(uSampler, vTexCoord + onePixel * vec2(-1, -1)) * uKernel[1] + texture2D(uSampler, vTexCoord + onePixel * vec2( 0, -1)) * uKernel[1] + texture2D(uSampler, vTexCoord + onePixel * vec2( 1, -1)) * uKernel[2] + texture2D(uSampler, vTexCoord + onePixel * vec2(-1,  0)) * uKernel[3] + texture2D(uSampler, vTexCoord + onePixel * vec2( 0,  0)) * uKernel[4] + texture2D(uSampler, vTexCoord + onePixel * vec2( 1,  0)) * uKernel[5] + texture2D(uSampler, vTexCoord + onePixel * vec2(-1,  1)) * uKernel[6] + texture2D(uSampler, vTexCoord + onePixel * vec2( 0,  1)) * uKernel[7] + texture2D(uSampler, vTexCoord + onePixel * vec2( 1,  1)) * uKernel[8];";var b="float kernelWeight = uKernel[0] + uKernel[1] + uKernel[2] + uKernel[3] + uKernel[4] + uKernel[5] + uKernel[6] +uKernel[7] +uKernel[8];if(kernelWeight <= 0.0){kernelWeight = 1.0;}";a=a+b;a=a+"gl_FragColor = vec4((colorSum / kernelWeight).rgb, 1);}";return new OMEGA.Omega3D.PostProcessingKernelShader(c,a,d)};OMEGA.Omega3D.Shaders.PostProcessingKernel.Kernels={normal:[0,0,0,0,1,0,0,0,0],gaussianBlur:[0.045,0.122,0.045,0.122,0.332,0.122,0.045,0.122,0.045],gaussianBlur2:[1,2,1,2,4,2,1,2,1],gaussianBlur3:[0,1,0,1,1,1,0,1,0],gaussianBlur4:[0,16,0,16,0,16,0,16,0],unsharpen:[-1,-1,-1,-1,9,-1,-1,-1,-1],sharpness:[0,-1,0,-1,5,-1,0,-1,0],sharpen:[0,-1,0,-1,16,-1,0,-1,0],edgeDetect:[-0.125,-0.125,-0.125,-0.125,1,-0.125,-0.125,-0.125,-0.125],edgeDetect2:[-1,-1,-1,-1,8,-1,-1,-1,-1],edgeDetect3:[-5,0,0,0,0,0,0,0,5],edgeDetect4:[-1,-1,-1,0,0,0,1,1,1],edgeDetect5:[-1,-1,-1,2,2,2,-1,-1,-1],edgeDetect6:[-5,-5,-5,-5,39,-5,-5,-5,-5],sobelHorizontal:[1,2,1,0,0,0,-1,-2,-1],sobelVertical:[1,0,-1,2,0,-2,1,0,-1],previtHorizontal:[1,1,1,0,0,0,-1,-1,-1],previtVertical:[1,0,-1,1,0,-1,1,0,-1],boxBlur:[0.111,0.111,0.111,0.111,0.111,0.111,0.111,0.111,0.111],robbieBlur:[0,0,0,0,12,0,0,0,0],triangleBlur:[0.0625,0.125,0.0625,0.125,0.25,0.125,0.0625,0.125,0.0625],emboss:[-2,-1,0,-1,1,1,0,1,2]};function Texture(b,c,a){if(!OMEGA.Omega3D.GL){return null}this.ID=a||0;this.gl_context=OMEGA.Omega3D.GL;this.img=b;this.isCubeMap=true;this.needsUpdate=c||false;this.tex=this.gl_context.createTexture();this.tex_id=this.ID==0?"uSampler":"uSampler"+this.ID;this.isEnabled=false;this.isDirty=true;this.GetTexture=function(){return this.tex};this.GetImage=function(){return this.img};this.SetImage=function(d){this.img=d;this.isDirty=true};this.handleTextureLoaded=function(e,d){};this.Enable=function(d){};this.Disable=function(){};this.IsPowerOf2=function(d){return((d&(d-1))==0)};this.Update=function(){if(!this.needsUpdate){if(!this.isDirty){return}}this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,this.tex);if(this.img==null){this.isDirty=false;return}if(this.img.toString()=="[object HTMLVideoElement]"){if(this.img.paused){return}}if(this.img){this.gl_context.texImage2D(this.gl_context.TEXTURE_2D,0,this.gl_context.RGBA,this.gl_context.RGBA,this.gl_context.UNSIGNED_BYTE,this.img)}this.isDirty=false};this.GenerateMipmap=function(){this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,this.tex);this.gl_context.generateMipmap(this.gl_context.TEXTURE_2D);this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,null)}}OMEGA.Omega3D.Texture=Texture;OMEGA.Omega3D.Texture.TEXTURE0=33984;function BasicTexture(b,c,a){Texture.apply(this,arguments);this.handleTextureLoaded=function(f,e){if(!this.needsUpdate){this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,e);this.gl_context.pixelStorei(this.gl_context.UNPACK_FLIP_Y_WEBGL,false);if(f){this.gl_context.texImage2D(this.gl_context.TEXTURE_2D,this.ID,this.gl_context.RGBA,this.gl_context.RGBA,this.gl_context.UNSIGNED_BYTE,f)}this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MIN_FILTER,this.gl_context.NEAREST);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MAG_FILTER,this.gl_context.NEAREST);if(f&&this.IsPowerOf2(f.width)&&this.IsPowerOf2(f.height)){this.gl_context.generateMipmap(this.gl_context.TEXTURE_2D);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MIN_FILTER,this.gl_context.NEAREST_MIPMAP_LINEAR)}else{this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MIN_FILTER,this.gl_context.LINEAR);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MAG_FILTER,this.gl_context.LINEAR);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_S,this.gl_context.CLAMP_TO_EDGE);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_T,this.gl_context.CLAMP_TO_EDGE)}if(Omega3D.EXT.anisotropic_filtering!=null){var d=this.gl_context.getParameter(Omega3D.EXT.anisotropic_filtering.MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.gl_context.texParameterf(this.gl_context.TEXTURE_2D,Omega3D.EXT.anisotropic_filtering.TEXTURE_MAX_ANISOTROPY_EXT,d)}this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,null)}else{this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,e);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MAG_FILTER,this.gl_context.LINEAR);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MIN_FILTER,this.gl_context.LINEAR);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_S,this.gl_context.CLAMP_TO_EDGE);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_T,this.gl_context.CLAMP_TO_EDGE)}};this.Enable=function(e){this.gl_context.activeTexture(this.gl_context.TEXTURE0+this.ID);this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,this.tex);if(e&&this.img){var d=e.GetSamplerLocation(this.tex_id);this.gl_context.uniform1i(d,this.ID)}};this.Disable=function(){this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,null)};this.handleTextureLoaded(this.img,this.tex)}BasicTexture.prototype=new Texture();OMEGA.Omega3D.BasicTexture=BasicTexture;function CubemapTexture(c,b,a){Texture.apply(this,arguments);this.faces=[this.gl_context.TEXTURE_CUBE_MAP_POSITIVE_X,this.gl_context.TEXTURE_CUBE_MAP_NEGATIVE_X,this.gl_context.TEXTURE_CUBE_MAP_NEGATIVE_Y,this.gl_context.TEXTURE_CUBE_MAP_POSITIVE_Y,this.gl_context.TEXTURE_CUBE_MAP_POSITIVE_Z,this.gl_context.TEXTURE_CUBE_MAP_NEGATIVE_Z];this.handleTextureLoaded=function(e,d){this.gl_context.bindTexture(this.gl_context.TEXTURE_CUBE_MAP,this.tex);this.gl_context.texParameteri(this.gl_context.TEXTURE_CUBE_MAP,this.gl_context.TEXTURE_WRAP_S,this.gl_context.CLAMP_TO_EDGE);this.gl_context.texParameteri(this.gl_context.TEXTURE_CUBE_MAP,this.gl_context.TEXTURE_WRAP_T,this.gl_context.CLAMP_TO_EDGE);this.gl_context.texParameteri(this.gl_context.TEXTURE_CUBE_MAP,this.gl_context.TEXTURE_MIN_FILTER,this.gl_context.LINEAR);this.gl_context.texParameteri(this.gl_context.TEXTURE_CUBE_MAP,this.gl_context.TEXTURE_MAG_FILTER,this.gl_context.LINEAR);this.UpdateFaces(e)};this.UpdateFaces=function(e){for(var d=0;d<this.faces.length;d++){this.gl_context.pixelStorei(this.gl_context.UNPACK_FLIP_Y_WEBGL,true);this.gl_context.texImage2D(this.faces[d],0,this.gl_context.RGBA,this.gl_context.RGBA,this.gl_context.UNSIGNED_BYTE,e[d])}};this.Enable=function(d){this.gl_context.activeTexture(this.gl_context.TEXTURE0+this.ID);this.gl_context.bindTexture(this.gl_context.TEXTURE_CUBE_MAP,this.tex);if(d){this.gl_context.uniform1i(d.GetSamplerLocation(),this.ID)}};this.Disable=function(){this.gl_context.bindTexture(this.gl_context.TEXTURE_CUBE_MAP,null)};this.handleTextureLoaded(this.img,this.tex)}CubemapTexture.prototype=new Texture();OMEGA.Omega3D.CubemapTexture=CubemapTexture;function ShadowMapTexture(b,f,a){a=a||0;Texture.apply(this,[null,true,a]);var e=this.gl_context.getExtension("WEBKIT_WEBGL_depth_texture")||this.gl_context.getExtension("MOZ_OES_depth_texture")||this.gl_context.getExtension("WEBKIT_OES_depth_texture")||this.gl_context.getExtension("WEBGL_depth_texture")||this.gl_context.getExtension("OES_depth_texture")||this.gl_context.getExtension("MOZ_WEBGL_depth_texture");if(!e){alert("Depthtextures not available in this browser.")}var d=this.gl_context.createFramebuffer();this.gl_context.bindFramebuffer(this.gl_context.FRAMEBUFFER,d);d.width=b||1024;d.height=f||1024;var c=this.gl_context.createTexture();this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,c);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MAG_FILTER,this.gl_context.NEAREST);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MIN_FILTER,this.gl_context.NEAREST);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_S,this.gl_context.CLAMP_TO_EDGE);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_T,this.gl_context.CLAMP_TO_EDGE);this.gl_context.texImage2D(this.gl_context.TEXTURE_2D,0,this.gl_context.RGBA,d.width,d.height,0,this.gl_context.RGBA,this.gl_context.FLOAT,null);this.tex=this.gl_context.createTexture();this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,this.tex);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_S,this.gl_context.CLAMP_TO_EDGE);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_T,this.gl_context.CLAMP_TO_EDGE);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MAG_FILTER,this.gl_context.NEAREST);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MIN_FILTER,this.gl_context.NEAREST);this.gl_context.texImage2D(this.gl_context.TEXTURE_2D,0,this.gl_context.DEPTH_COMPONENT,d.width,d.height,0,this.gl_context.DEPTH_COMPONENT,this.gl_context.UNSIGNED_SHORT,null);this.gl_context.framebufferTexture2D(this.gl_context.FRAMEBUFFER,this.gl_context.COLOR_ATTACHMENT0,this.gl_context.TEXTURE_2D,c,0);this.gl_context.framebufferTexture2D(this.gl_context.FRAMEBUFFER,this.gl_context.DEPTH_ATTACHMENT,this.gl_context.TEXTURE_2D,this.tex,0);this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,null);this.gl_context.bindFramebuffer(this.gl_context.FRAMEBUFFER,null);this.GetFrameBuffer=function(){return d};this.Enable=function(g){this.gl_context.activeTexture(this.gl_context.TEXTURE0+this.ID);this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,this.tex);if(g){this.gl_context.uniform1i(g.GetSamplerLocation(this.tex_id),this.ID)}};if(this.gl_context.checkFramebufferStatus(this.gl_context.FRAMEBUFFER)!=this.gl_context.FRAMEBUFFER_COMPLETE){console.error("[ShadowMapTexture] Framebuffer incomplete!");switch(this.gl_context.checkFramebufferStatus(this.gl_context.FRAMEBUFFER)){case this.gl_context.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.error("[ShadowMapTexture] FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case this.gl_context.GL_FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.error("[ShadowMapTexture] GL_FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case this.gl_context.GL_FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.error("[ShadowMapTexture] GL_FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case this.gl_context.GL_FRAMEBUFFER_UNSUPPORTED:console.error("[ShadowMapTexture] GL_FRAMEBUFFER_UNSUPPORTED");break;default:console.error("[ShadowMapTexture] "+this.gl_context.checkFramebufferStatus(this.gl_context.FRAMEBUFFER));break}}}ShadowMapTexture.prototype=new Texture();OMEGA.Omega3D.ShadowMapTexture=ShadowMapTexture;function FrameBufferTexture(b,e,a){Texture.apply(this,[null,true,a]);var d,c;d=this.gl_context.createFramebuffer();this.gl_context.bindFramebuffer(this.gl_context.FRAMEBUFFER,d);d.width=b||1024;d.height=e||1024;this.tex=this.gl_context.createTexture();this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,this.tex);this.gl_context.pixelStorei(this.gl_context.UNPACK_FLIP_Y_WEBGL,true);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_S,this.gl_context.CLAMP_TO_EDGE);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_T,this.gl_context.CLAMP_TO_EDGE);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MAG_FILTER,this.gl_context.LINEAR);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MIN_FILTER,this.gl_context.LINEAR);this.gl_context.texImage2D(this.gl_context.TEXTURE_2D,0,this.gl_context.RGBA,d.width,d.height,0,this.gl_context.RGBA,this.gl_context.FLOAT,null);var c=this.gl_context.createRenderbuffer();this.gl_context.bindRenderbuffer(this.gl_context.RENDERBUFFER,c);this.gl_context.renderbufferStorage(this.gl_context.RENDERBUFFER,this.gl_context.DEPTH_COMPONENT16,d.width,d.height);this.gl_context.framebufferTexture2D(this.gl_context.FRAMEBUFFER,this.gl_context.COLOR_ATTACHMENT0,this.gl_context.TEXTURE_2D,this.tex,0);this.gl_context.framebufferRenderbuffer(this.gl_context.FRAMEBUFFER,this.gl_context.DEPTH_ATTACHMENT,this.gl_context.RENDERBUFFER,c);if(!this.gl_context.checkFramebufferStatus(this.gl_context.FRAMEBUFFER)===this.gl_context.FRAMEBUFFER_COMPLETE){console.error("Framebuffer incomplete!")}this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,null);this.gl_context.bindFramebuffer(this.gl_context.FRAMEBUFFER,null);this.Enable=function(g){this.gl_context.activeTexture(this.gl_context.TEXTURE0+this.ID);this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,this.tex);if(g){var f=g.GetSamplerLocation(this.tex_id);this.gl_context.uniform1i(f,this.ID)}};this.GetFrameBuffer=function(){return d};this.Disable=function(){this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,null);this.gl_context.bindRenderbuffer(this.gl_context.RENDERBUFFER,null);this.gl_context.bindFramebuffer(this.gl_context.FRAMEBUFFER,null)};this.Update=function(){if(!this.needsUpdate){if(!this.isDirty){return}}this.isDirty=false}}FrameBufferTexture.prototype=new Texture();OMEGA.Omega3D.FrameBufferTexture=FrameBufferTexture;function DynamicCubemapTexture(j,c,g,b){Texture.apply(this,[null,true,b]);var f,e;this.fov=76.978;this.near=0.1;this.far=1000;this.cubemapCam=new Omega3D.cameras.Camera();this.faces=[this.gl_context.TEXTURE_CUBE_MAP_POSITIVE_X,this.gl_context.TEXTURE_CUBE_MAP_NEGATIVE_X,this.gl_context.TEXTURE_CUBE_MAP_POSITIVE_Y,this.gl_context.TEXTURE_CUBE_MAP_NEGATIVE_Y,this.gl_context.TEXTURE_CUBE_MAP_POSITIVE_Z,this.gl_context.TEXTURE_CUBE_MAP_NEGATIVE_Z];this.tex=this.gl_context.createTexture();this.gl_context.bindTexture(this.gl_context.TEXTURE_CUBE_MAP,this.tex);this.gl_context.texParameteri(this.gl_context.TEXTURE_CUBE_MAP,this.gl_context.TEXTURE_WRAP_S,this.gl_context.CLAMP_TO_EDGE);this.gl_context.texParameteri(this.gl_context.TEXTURE_CUBE_MAP,this.gl_context.TEXTURE_WRAP_T,this.gl_context.CLAMP_TO_EDGE);this.gl_context.texParameteri(this.gl_context.TEXTURE_CUBE_MAP,this.gl_context.TEXTURE_MIN_FILTER,this.gl_context.LINEAR);this.gl_context.texParameteri(this.gl_context.TEXTURE_CUBE_MAP,this.gl_context.TEXTURE_MAG_FILTER,this.gl_context.LINEAR);if(Omega3D.EXT.anisotropic_filtering!=null){var a=this.gl_context.getParameter(Omega3D.EXT.anisotropic_filtering.MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.gl_context.texParameterf(this.gl_context.TEXTURE_CUBE_MAP,Omega3D.EXT.anisotropic_filtering.TEXTURE_MAX_ANISOTROPY_EXT,a)}for(var d=0;d<6;d++){this.gl_context.texImage2D(this.faces[d],0,this.gl_context.RGBA,this.gl_context.RGBA,this.gl_context.UNSIGNED_BYTE,j[d])}f=this.gl_context.createFramebuffer();this.gl_context.bindFramebuffer(this.gl_context.FRAMEBUFFER,f);f.width=c||1024;f.height=g||1024;e=this.gl_context.createRenderbuffer();this.gl_context.bindRenderbuffer(this.gl_context.RENDERBUFFER,e);this.gl_context.renderbufferStorage(this.gl_context.RENDERBUFFER,this.gl_context.DEPTH_COMPONENT16,f.width,f.height);this.gl_context.framebufferRenderbuffer(this.gl_context.FRAMEBUFFER,this.gl_context.DEPTH_ATTACHMENT,this.gl_context.RENDERBUFFER,e);this.gl_context.framebufferTexture2D(this.gl_context.FRAMEBUFFER,this.gl_context.COLOR_ATTACHMENT0,this.faces[0],this.tex,0);if(!this.gl_context.checkFramebufferStatus(this.gl_context.FRAMEBUFFER)===this.gl_context.FRAMEBUFFER_COMPLETE){console.error("Framebuffer incomplete!")}this.gl_context.bindFramebuffer(this.gl_context.FRAMEBUFFER,null);this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,null);this.UpdateFaces=function(m,k,l){this.gl_context.bindFramebuffer(this.gl_context.FRAMEBUFFER,this.GetFrameBuffer());this.cubemapCam.fov=this.fov;this.cubemapCam.near=this.near;this.cubemapCam.far=this.far;this.cubemapCam.ratio=1;for(var h=0;h<6;++h){this.UpdateFace(h,m,k,l,this.cubemapCam)}this.gl_context.bindFramebuffer(this.gl_context.FRAMEBUFFER,null)};this.UpdateFace=function(i,l,h,k){this.gl_context.framebufferTexture2D(this.gl_context.FRAMEBUFFER,this.gl_context.COLOR_ATTACHMENT0,this.faces[i],this.tex,0);var m=l;switch(i){case 0:this.cubemapCam.LookAtWithUp(m[0]+1,m[1],m[2],m,[0,-1,0]);break;case 1:this.cubemapCam.LookAtWithUp(m[0]-1,m[1],m[2],m,[0,-1,0]);break;case 2:this.cubemapCam.LookAtWithUp(m[0],m[1]+10,m[2],m,[0,0,1]);break;case 3:this.cubemapCam.LookAtWithUp(m[0],m[1]-10,m[2],m,[0,0,-1]);break;case 4:this.cubemapCam.LookAtWithUp(m[0],m[1],m[2]+1,m,[0,-1,0]);break;case 5:this.cubemapCam.LookAtWithUp(m[0],m[1],m[2]-1,m,[0,-1,0]);break}this.gl_context.enable(this.gl_context.DEPTH_TEST);h.viewPort(k,0,0,this.GetFrameBuffer().width,this.GetFrameBuffer().height);h.renderScene(k,this.cubemapCam);this.gl_context.disable(this.gl_context.DEPTH_TEST)};this.Enable=function(i){this.gl_context.activeTexture(this.gl_context.TEXTURE0+this.ID);this.gl_context.bindTexture(this.gl_context.TEXTURE_CUBE_MAP,this.tex);if(i){var h=i.GetSamplerLocation(this.tex_id);this.gl_context.uniform1i(h,this.ID)}};this.GetFrameBuffer=function(){return f};this.Disable=function(){this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,null);this.gl_context.bindRenderbuffer(this.gl_context.RENDERBUFFER,null);this.gl_context.bindFramebuffer(this.gl_context.FRAMEBUFFER,null)};this.Update=function(){if(!this.needsUpdate){if(!this.isDirty){return}}this.isDirty=false}}DynamicCubemapTexture.prototype=new Texture();OMEGA.Omega3D.DynamicCubemapTexture=DynamicCubemapTexture;function DefferedRenderingTexture(b,d,a){Texture.apply(this,[null,true,a]);if(Omega3D.EXT.draw_buffers==null){alert("Draw Buffers not supported.")}this.textures=new Array();var c;this.handleTextureLoaded=function(g,f){c=this.gl_context.createFramebuffer();this.gl_context.bindFramebuffer(this.gl_context.FRAMEBUFFER,c);c.width=b||1024;c.height=d||1024;this.depthTexture=this.gl_context.createTexture();this.normalTexture=this.gl_context.createTexture();this.positionTexture=this.gl_context.createTexture();this.colorTexture=this.gl_context.createTexture();this.depthRGBTexture=this.gl_context.createTexture();this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,this.normalTexture);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_S,this.gl_context.CLAMP_TO_EDGE);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_T,this.gl_context.CLAMP_TO_EDGE);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MIN_FILTER,this.gl_context.NEAREST);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MAG_FILTER,this.gl_context.NEAREST);this.gl_context.texImage2D(this.gl_context.TEXTURE_2D,0,this.gl_context.RGBA,b,d,0,this.gl_context.RGBA,this.gl_context.FLOAT,null);this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,this.positionTexture);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_S,this.gl_context.CLAMP_TO_EDGE);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_T,this.gl_context.CLAMP_TO_EDGE);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MIN_FILTER,this.gl_context.NEAREST);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MAG_FILTER,this.gl_context.NEAREST);this.gl_context.texImage2D(this.gl_context.TEXTURE_2D,0,this.gl_context.RGBA,b,d,0,this.gl_context.RGBA,this.gl_context.FLOAT,null);this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,this.colorTexture);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_S,this.gl_context.CLAMP_TO_EDGE);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_T,this.gl_context.CLAMP_TO_EDGE);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MIN_FILTER,this.gl_context.NEAREST);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MAG_FILTER,this.gl_context.NEAREST);this.gl_context.texImage2D(this.gl_context.TEXTURE_2D,0,this.gl_context.RGBA,b,d,0,this.gl_context.RGBA,this.gl_context.FLOAT,null);this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,this.depthRGBTexture);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_S,this.gl_context.CLAMP_TO_EDGE);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_T,this.gl_context.CLAMP_TO_EDGE);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MAG_FILTER,this.gl_context.NEAREST);this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MIN_FILTER,this.gl_context.NEAREST);this.gl_context.texImage2D(this.gl_context.TEXTURE_2D,0,this.gl_context.RGBA,b,d,0,this.gl_context.RGBA,this.gl_context.FLOAT,null);if(Omega3D.EXT.draw_buffers!=null){this.buffers=[];this.buffers[0]=Omega3D.EXT.draw_buffers.COLOR_ATTACHMENT0_WEBGL;this.buffers[1]=Omega3D.EXT.draw_buffers.COLOR_ATTACHMENT1_WEBGL;this.buffers[2]=Omega3D.EXT.draw_buffers.COLOR_ATTACHMENT2_WEBGL;this.buffers[3]=Omega3D.EXT.draw_buffers.COLOR_ATTACHMENT3_WEBGL;var e=this.gl_context.createRenderbuffer();this.gl_context.bindRenderbuffer(this.gl_context.RENDERBUFFER,e);this.gl_context.renderbufferStorage(this.gl_context.RENDERBUFFER,this.gl_context.DEPTH_COMPONENT16,c.width,c.height);this.gl_context.framebufferTexture2D(this.gl_context.FRAMEBUFFER,this.buffers[0],this.gl_context.TEXTURE_2D,this.normalTexture,0);this.gl_context.framebufferTexture2D(this.gl_context.FRAMEBUFFER,this.buffers[1],this.gl_context.TEXTURE_2D,this.positionTexture,0);this.gl_context.framebufferTexture2D(this.gl_context.FRAMEBUFFER,this.buffers[2],this.gl_context.TEXTURE_2D,this.colorTexture,0);this.gl_context.framebufferTexture2D(this.gl_context.FRAMEBUFFER,this.buffers[3],this.gl_context.TEXTURE_2D,this.depthRGBTexture,0);this.gl_context.framebufferRenderbuffer(this.gl_context.FRAMEBUFFER,this.gl_context.DEPTH_ATTACHMENT,this.gl_context.RENDERBUFFER,e);if(this.gl_context.checkFramebufferStatus(this.gl_context.FRAMEBUFFER)!==this.gl_context.FRAMEBUFFER_COMPLETE){console.error("Framebuffer incomplete!")}Omega3D.EXT.draw_buffers.drawBuffersWEBGL(this.buffers);this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,null);this.gl_context.bindFramebuffer(this.gl_context.FRAMEBUFFER,null)}};this.Enable=function(e){this.gl_context.bindFramebuffer(this.gl_context.FRAMEBUFFER,c)};this.GetFrameBuffer=function(){return c};this.Disable=function(){this.gl_context.bindFramebuffer(this.gl_context.FRAMEBUFFER,null)};this.Update=function(){if(!this.needsUpdate){if(!this.isDirty){return}}this.isDirty=false};this.handleTextureLoaded(this.img,this.tex)}DefferedRenderingTexture.prototype=new Texture();OMEGA.Omega3D.DefferedRenderingTexture=DefferedRenderingTexture;function Mesh(a){this.combinedBuffer;this.vertexBuffer;this.normalBuffer;this.indexBuffer;this.uvBuffer;this.tangentBuffer;this.bitangentBuffer;this.colorPickingBuffer;this.combined=new Array();this.geometry=a;this.gl=OMEGA.Omega3D.GL;this.GetCombinedBuffer=function(){return this.combinedBuffer};this.GetVertexBuffer=function(){return this.vertexBuffer};this.GetUVBuffer=function(){return this.uvBuffer};this.GetIndexBuffer=function(){return this.indexBuffer};this.GetNormalBuffer=function(){return this.normalBuffer};this.GetTangentBuffer=function(){return this.tangentBuffer};this.GetBitangentBuffer=function(){return this.bitangentBuffer};this.GetColorPickingBuffer=function(){return this.colorPickingBuffer};this.GetIndexCount=function(){return this.geometry.GetIndexes()/3};this.GetGeometry=function(){return this.geometry};this.ApplyGeometry=function(b){this.geometry=b;if(this.geometry.isDirty){this.CreateBuffers()}};this.CreateBuffers=function(){this.combined=new Array();var k=this.geometry.GetVertices();var m=this.geometry.GetNormals();var g=this.geometry.GetUVS();var l=this.geometry.tangents;var j=this.geometry.bitangents;var c=new Array();for(var h=0;h<k.length;h++){c.push(1)}this.geometry.SetColors(c);var e=0;var f=0,d=1,b=0;for(var h=0;h<k.length;h+=3){this.combined.push(k[h],k[h+1],k[h+2],m[h],m[h+1],m[h+2],g[e],g[e+1],l[h],l[h+1],l[h+2],j[h],j[h+1],j[h+2],c[h],c[h+1],c[h+2]);e+=2;if(e>=k.length){e=0}}this.combinedBuffer=null;this.combinedBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.combinedBuffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.combined),this.gl.STATIC_DRAW);if(this.geometry.GetIndexes().length>0){if(!this.indexBuffer){this.indexBuffer=this.gl.createBuffer()}this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.geometry.GetIndexes()),this.gl.STATIC_DRAW);this.indexBuffer.itemSize=1;this.indexBuffer.numItems=this.geometry.GetIndexes().length}this.geometry.isDirty=false};this.CreateColorPickingBuffer=function(b){if(parseFloat(b)>-1){var e=new Array();var c=1/255;var j=parseFloat(b);var k=255,f=0,d=0,h=0;f=j<=k?j:k;if(j>(k*1)){d=j-f}if(j>(k*2)){h=j-(f+d)}for(var g=0;g<this.geometry.GetVertices().length;g++){e.push(c*f,c*d,c*h)}if(!this.colorPickingBuffer){this.colorPickingBuffer=this.gl.createBuffer()}this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.colorPickingBuffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(e),this.gl.STATIC_DRAW);this.colorPickingBuffer.itemSize=3;this.colorPickingBuffer.numItems=e.length/this.colorPickingBuffer.itemSize}};this.Update=function(){if(this.geometry.isDirty){this.CreateBuffers()}}}OMEGA.Omega3D.Mesh=Mesh;function Geometry(){this.vertices=new Array();this.colors=new Array();this.normals=new Array();this.uvs=new Array();this.tangents=new Array();this.bitangents=new Array();this.vertices_raw=new Array();this.normals_raw=new Array();this.uvs_raw=new Array();this.tangents_raw=new Array();this.bitangents_raw=new Array();this.indexes=new Array();this.faces=new Array();this.scale=1;this.isDirty=true;this.SetVertices=function(a){this.vertices=a;this.isDirty=true};this.SetColors=function(a){this.colors=a;this.isDirty=true};this.SetNormals=function(a){this.normals=a;this.isDirty=true};this.SetUVS=function(a){this.uvs=a;this.isDirty=true};this.SetIndexes=function(a){this.indexes=a;this.isDirty=true};this.SetFaces=function(a){this.faces=a;this.isDirty=true};this.SetTangents=function(a){this.tangents=a;this.isDirty=true};this.SetBitangents=function(a){this.bitangents=a;this.isDirty=true};this.GetVertices=function(){return this.vertices};this.GetColors=function(){return this.colors};this.GetNormals=function(){return this.normals};this.GetUVS=function(){return this.uvs};this.GetTangents=function(){return this.tangents};this.GetBitangents=function(){return this.bitangents};this.GetIndexes=function(){return this.indexes};this.GetFaces=function(){return this.faces};this.GetLengthBetweenPoints=function(g,e){var h=e.x-g.x;var f=e.y-g.y;var d=e.z-g.z;var c=h*h+f*f+d*d;return Math.sqrt(c)};this.UpdateAtlasUV=function(e,a,g){var h=new Array();var f=(e.w)/g;var d=(e.h)/a;for(var c=0;c<a;c++){for(var b=0;b<g;b++){h.push(e.x+(f*b));h.push(e.y+(d*c))}}this.SetUVS(h)}}Geometry.ComputeIndices=function(a,d,e){for(var c=0;c<d;c++){for(var b=0;b<a;b++){if(c<d-1&&b<a-1){e.push(c*a+b,c*a+b+1,(c+1)*a+b);e.push(c*a+b+1,(c+1)*a+b+1,(c+1)*a+b)}}}};Geometry.ComputeTangentBasis=function(d,h,n,c,t){var v=9;for(var o=0;o<d.length;o+=v){var s=new Vector3(d[o+0],d[o+1],d[o+2]);var q=new Vector3(d[o+3],d[o+4],d[o+5]);var p=new Vector3(d[o+6],d[o+7],d[o+8]);var l=new Vector2(h[o+0],h[o+1],h[o+2]);var k=new Vector2(h[o+3],h[o+4],h[o+5]);var j=new Vector2(h[o+6],h[o+7],h[o+8]);var b=Vector3.Subtract(q,s);var a=Vector3.Subtract(p,s);var g=Vector2.Subtract(k,l);var f=Vector2.Subtract(j,l);var m=1/(g.x*f.y-g.y*f.x);var e=Vector3.MultiplyByValue(Vector2.Subtract(Vector3.MultiplyByValue(b,f.y),Vector3.MultiplyByValue(a,g.y)),m);var u=Vector3.MultiplyByValue(Vector3.Subtract(Vector3.MultiplyByValue(a,g.x),Vector3.MultiplyByValue(b,f.x)),m);c.push(e);c.push(e);c.push(e);t.push(u);t.push(u);t.push(u)}};Geometry.ComputeFaces=function(a,e,g){for(var b=0;b<e.length;b+=9){var f={x:a[e[b]],y:a[e[b+1]],z:a[e[b+2]]};var d={x:a[e[b+3]],y:a[e[b+4]],z:a[e[b+5]]};var c={x:a[e[b+6]],y:a[e[b+7]],z:a[e[b+8]]};g.push({a:f,b:d,c:c})}};OMEGA.Omega3D.Geometry=Geometry;function CubeGeometry(d,a,f){Geometry.apply(this);var c=d/2||this.scale;var e=a/2||c||this.scale;var b=f/2||c||this.scale;this.vertices=[-1*c,-1*e,1*b,1*c,-1*e,1*b,1*c,1*e,1*b,-1*c,1*e,1*b,-1*c,-1*e,-1*b,-1*c,1*e,-1*b,1*c,1*e,-1*b,1*c,-1*e,-1*b,-1*c,1*e,-1*b,-1*c,1*e,1*b,1*c,1*e,1*b,1*c,1*e,-1*b,-1*c,-1*e,-1*b,1*c,-1*e,-1*b,1*c,-1*e,1*b,-1*c,-1*e,1*b,1*c,-1*e,-1*b,1*c,1*e,-1*b,1*c,1*e,1*b,1*c,-1*e,1*b,-1*c,-1*e,-1*b,-1*c,-1*e,1*b,-1*c,1*e,1*b,-1*c,1*e,-1*b];this.normals=[0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0];this.indexes=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];this.uvs=[1,0,0,0,0,1,1,1,0,0,0,1,1,1,1,0,1,1,1,0,0,0,0,1,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,1,0,0,0,0,1,1,1]}CubeGeometry.prototype=new Geometry();OMEGA.Omega3D.Geometry.CubeGeometry=CubeGeometry;function CylinderGeometry(b,c,d,n){Geometry.apply(this);var s=c||this.scale*0.25;var p=b||this.scale;var d=d||15;var n=n||10;var k,q,u;var w,a;var e,m,g,x,f;e=new Array();m=new Array();g=new Array();x=new Array();f=new Array();for(var v=0;v<n;v++){for(var t=0;t<d;t++){w=(Math.PI*2/(d-1)*t);a=(Math.PI*v/(n-1)-Math.PI/2);k=Math.cos(w)*s;q=v*(p/n)-(p/2);u=Math.sin(w)*s;var o=new Vector3(k,q,u);var h=new Vector2(t/(d-1),v/(n-1));var y=new Vector3(Math.cos(w)*-1,0,Math.sin(w)*-1);e.push(o);g.push(y);m.push(h)}}OMEGA.Omega3D.VBOUtil.ComputeTangentBasis(e,m,g,x,f);OMEGA.Omega3D.VBOUtil.IndexTB(e,m,g,x,f,this.vertices_raw,this.uvs_raw,this.normals_raw,this.tangents_raw,this.bitangents_raw);OMEGA.Omega3D.VBOUtil.FlattenMeshDataTB(e,m,g,x,f,this.vertices,this.uvs,this.normals,this.tangents,this.bitangents);OMEGA.Omega3D.VBOUtil.ComputeIndices(d,n,this.indexes);Geometry.ComputeFaces(this.vertices,this.indexes,this.faces)}CylinderGeometry.prototype=new Geometry();OMEGA.Omega3D.Geometry.CylinderGeometry=CylinderGeometry;function SphereGeometry(c,d,n){Geometry.apply(this);if(c){this.scale=c}var c=c||this.scale;n=n||15;d=d||15;var r=0;var a=0;var e,m,g,s,f;e=new Array();m=new Array();g=new Array();s=new Array();f=new Array();for(var q=0;q<d;q++){for(var p=0;p<n;p++){r=Math.PI*2/(d-1)*p;a=Math.PI*q/(n-1)-Math.PI/2;var b=Math.cos(r)*c*Math.cos(a);var h=Math.sin(a)*c;var l=Math.sin(r)*c*Math.cos(a);var o=new Vector3(b,h,l);var k=new Vector2(p/(d-1),1-q/(n-1));var t=new Vector3(Math.cos(r)*Math.cos(a),Math.sin(a),Math.sin(r)*Math.cos(a));this.vertices.push(b);this.vertices.push(h);this.vertices.push(l);this.normals.push(-t.x);this.normals.push(-t.y);this.normals.push(-t.z);this.uvs.push(p/(n-1));this.uvs.push(q/(d-1));if(q<d-1&&p<n-1){this.indexes.push(q*n+p);this.indexes.push(q*n+p+1);this.indexes.push((q+1)*n+p);this.indexes.push(q*n+p+1);this.indexes.push((q+1)*n+p+1);this.indexes.push((q+1)*n+p)}}}OMEGA.Omega3D.VBOUtil.ComputeTangentBasis(e,m,g,s,f);OMEGA.Omega3D.VBOUtil.IndexTB(e,m,g,s,f,this.vertices_raw,this.uvs_raw,this.normals_raw,this.tangents_raw,this.bitangents_raw);OMEGA.Omega3D.VBOUtil.FlattenMeshDataTB(e,m,g,s,f,this.vertices,this.uvs,this.normals,this.tangents,this.bitangents);OMEGA.Omega3D.VBOUtil.ComputeIndices(n,d,this.indexes);Geometry.ComputeFaces(this.vertices,this.indexes,this.faces)}SphereGeometry.prototype=new Geometry();OMEGA.Omega3D.Geometry.SphereGeometry=SphereGeometry;function SquareGeometry(q,p,b,n){Geometry.apply(this);var v=q||1;var c=p||1;var b=b||150;var n=n||150;var k=q*2/(b-1);var r=p*2/(n-1);var d,m,f,u,e;d=new Array();m=new Array();f=new Array();u=new Array();e=new Array();for(var t=0;t<n;t++){for(var s=0;s<b;s++){var a=-v+(s*k);var h=-c+(t*r);var l=0;var o=new Vector3(a,h,l);var g=new Vector2(1-s/(b-1),1-t/(n-1));var w=new Vector3(0,0,1);d.push(o);f.push(w);m.push(g);this.colors.push(1);this.colors.push(1);this.colors.push(1)}}OMEGA.Omega3D.VBOUtil.ComputeTangentBasis(d,m,f,u,e);OMEGA.Omega3D.VBOUtil.IndexTB(d,m,f,u,e,this.vertices_raw,this.uvs_raw,this.normals_raw,this.tangents_raw,this.bitangents_raw);OMEGA.Omega3D.VBOUtil.FlattenMeshDataTB(d,m,f,u,e,this.vertices,this.uvs,this.normals,this.tangents,this.bitangents);OMEGA.Omega3D.VBOUtil.ComputeIndices(b,n,this.indexes);Geometry.ComputeFaces(this.vertices,this.indexes,this.faces)}SquareGeometry.prototype=new Geometry();OMEGA.Omega3D.Geometry.SquareGeometry=SquareGeometry;function TorusGeometry(l,a,e,r){Geometry.apply(this);var e=e||40;var r=r||50;var c=l||this.scale;var h=a||c/2;var k,d,q,p,o,m;var b=0;var n=0;for(var g=0;g<e;g++){b=(((Math.PI*2)/(e-1))*g);for(var f=0;f<r;f++){n=(((Math.PI*2)/(r-1))*f);k=(Math.cos(b)*(Math.cos(n)*h-c));d=(Math.sin(b)*(Math.cos(n)*h-c));q=(Math.sin(n)*h);p=(Math.cos(b)*Math.cos(n));o=(Math.sin(b)*Math.cos(n));m=(Math.sin(n));this.vertices.push(-k);this.vertices.push(-d);this.vertices.push(-q);this.normals.push(p);this.normals.push(o);this.normals.push(m);this.uvs.push(f/(r-1));this.uvs.push(g/(e-1));if(g<e-1&&f<r-1){this.indexes.push(g*r+f);this.indexes.push(g*r+f+1);this.indexes.push((g+1)*r+f);this.indexes.push(g*r+f+1);this.indexes.push((g+1)*r+f+1);this.indexes.push((g+1)*r+f)}}}Geometry.ComputeFaces(this.vertices,this.indexes,this.faces)}TorusGeometry.prototype=new Geometry();OMEGA.Omega3D.Geometry.TorusGeometry=TorusGeometry;function TriangleGeometry(a){Geometry.apply(this,arguments);this.vertices=[0,1*this.scale,0,-1*this.scale,-1*this.scale,0,1*this.scale,-1*this.scale,0];this.uvs=[0.98,0.98,0.6,0,0,0.6];this.normals=[0,0,1,0,0,1,0,0,1];this.indexes=[0,1,2];Geometry.ComputeTangentBasis(this.vertices,this.uvs,this.normals,this.tangents,this.bitangents)}TriangleGeometry.prototype=new Geometry();OMEGA.Omega3D.Geometry.TriangleGeometry=TriangleGeometry;function IcosaGeometry(a,c){Geometry.apply(this);this.vertices.push(-a,0,c);this.vertices.push(a,0,c);this.vertices.push(-a,0,-c);this.vertices.push(a,0,-c);this.vertices.push(0,c,a);this.vertices.push(0,c,-a);this.vertices.push(0,-c,a);this.vertices.push(0,-c,-a);this.vertices.push(c,a,0);this.vertices.push(-c,a,0);this.vertices.push(c,-a,0);this.vertices.push(-c,-a,0);this.indexes.push(1,4,0);this.indexes.push(4,9,0);this.indexes.push(4,5,9);this.indexes.push(8,5,4);this.indexes.push(1,8,4);this.indexes.push(1,10,8);this.indexes.push(10,3,8);this.indexes.push(8,3,5);this.indexes.push(3,2,5);this.indexes.push(3,7,2);this.indexes.push(3,10,7);this.indexes.push(10,6,7);this.indexes.push(6,11,7);this.indexes.push(6,0,11);this.indexes.push(6,1,0);this.indexes.push(10,1,6);this.indexes.push(11,0,9);this.indexes.push(2,11,9);this.indexes.push(5,2,9);this.indexes.push(11,2,7);for(var b=0;b<this.vertices.length;b++){this.normals.push(this.vertices[b])}}IcosaGeometry.prototype=new Geometry();OMEGA.Omega3D.Geometry.IcosaGeometry=IcosaGeometry;function OBJParser(t){var q=String.fromCharCode(10);var l=String.fromCharCode(32);var d="/";var i="v";var n="vn";var b="vt";var w="f";var f=false;var v=1;var r=true;var p=0;var c=true;this.debug=t||false;var e=new Array(),j=new Array(),o=new Array(),u=new Array();var h=new Array(),s=new Array(),m=new Array(),k=new Array(),g=new Array();var a=new Array();this.GetObjects=function(){return a};this.GetVertices=function(){return h};this.GetNormals=function(){return s};this.GetUVS=function(){return m};this.GetIndexes=function(){return g};this.ParseToObject3D=function(E,z,D){a=new Array();if(this.debug){console.log("parsing: "+E)}this.reset();this.parseFile(E,z);var F;if(this.GetObjects().length==1){var A=this.GetObjects()[0];var y=new Omega3D.Geometry();y.SetVertices(A.vertices);y.SetNormals(A.normals);y.SetUVS(A.UVS);y.SetIndexes(A.indexes);var C=new Omega3D.Mesh(y);F=new Omega3D.Object3D(C,D.Clone());F.name=A.name}else{F=new Omega3D.Object3D();for(var B=0;B<this.GetObjects().length;B++){var A=this.GetObjects()[B];var y=new Omega3D.Geometry();y.SetVertices(A.vertices);y.SetNormals(A.normals);y.SetUVS(A.UVS);y.SetIndexes(A.indexes);var C=new Omega3D.Mesh(y);var x=new Omega3D.Object3D(C,D.Clone());x.name=A.name;x.SetParent(F)}}e=new Array();j=new Array();o=new Array();u=new Array();this.reset();return F};this.parseFile=function(A,B){var y=this;var x;var z=new XMLHttpRequest()||new ActiveXObject("MSXML2.XMLHTTP");z.open("GET",A,false);z.onreadystatechange=function(H){if(y.debug){console.log("[OBJParser] load ready. ")}v=B;var I=z.responseText;var L=I.split(q);L.push(null);var G=0;var M;var C=new OMEGA.Utils.StringParser();while((M=L[G++])!=null){C.Init(M);var D=C.GetFirstWord();var J=M.indexOf(" ");var F;if(C.words.length>0){F=C.words.slice(1)}if((F[0]=="")||(F[0]==" ")){F=F.slice(1)}switch(D){case"#":continue;case"mtllib":continue;case"o":case"g":var K=F[0];if(K.charCodeAt(K.length-1)==13){K=K.substr(0,K.length-1)}if(K=="default"||c==true){if(x!=null&&y.GetVertices().length>0){x.vertices=y.GetVertices();x.normals=y.GetNormals();x.UVS=y.GetUVS();x.indexes=y.GetIndexes();if(y.debug){y.debugObject(x)}y.reset()}var E={};a.push(E);x=E;c=false;if(y.debug){console.log("[OBJParser] adding from G. ")}continue}else{if(x!=null){x.name=M.substr(J+1,M.length-(J+2))}continue}continue;case"v":if(!x&&c==true){var E={};a.push(E);x=E;c=false;if(y.debug){console.log("[OBJParser] adding from V. ")}}y.parseVertex(F);continue;case"vn":y.parseNormal(F);continue;case"vt":if(F.length>2){F.pop()}if(F.length>2){console.log("vt is bigger than 2")}y.parseUV(F);break;case"usemtl":if(x!=null){x.mtl=C.words[1]}continue;case"f":y.parseIndex(F);continue}}if(x!=null){x.vertices=y.GetVertices();x.normals=y.GetNormals();x.UVS=y.GetUVS();x.indexes=y.GetIndexes();if(y.debug){y.debugObject(x)}y.reset()}};z.send(null)};this.parseVertex=function(A){if(f){e.push(parseFloat(A[1])*v);e.push(parseFloat(A[2])*v);e.push(parseFloat(A[0])*v)}else{var x=A.length;if(x>3){x=3}for(var z=0;z<x;++z){var y=A[z];u.push(Math.random());e.push(parseFloat(y)*v)}u.push(1)}};this.parseNormal=function(A){var x=A.length;if(x>3){x=3}for(var z=0;z<x;++z){var y=A[z];if(y!=null){j.push(parseFloat(y))}}};this.parseUV=function(A){var x=A.length;if(x>2){x=2}for(var z=0;z<x;++z){var y=A[z];o.push(Number(y))}};this.parseIndex=function(A){var F;var y;var x;var G;var D;var E;for(var B=0;B<A.length;B++){if(A[B]==""){A.splice(B,1)}}var B;var C=A.length;var z=0;while(A[z]==""||A[z]==" "){z++}C=z+3;for(B=z;B<C;++B){F=A[B];y=F.split(d);x=parseInt(y[0])-1;G=parseInt(y[1])-1;D=parseInt(y[2])-1;if(x<0){x=0}if(G<0){G=0}if(D<0){D=0}if(e.length){E=3*x;h.push(e[E+0],e[E+1],e[E+2])}k.push(Math.random(),Math.random(),Math.random(),1);if(j.length){E=3*D;s.push(-j[E+0],-j[E+1],-j[E+2])}E=2*G;if(r){m.push(o[E+0],1-o[E+1])}else{m.push(1-o[E+0],1-o[E+1])}}g.push(p,p+1,p+2);p+=3};this.reset=function(){h=new Array();s=new Array();m=new Array();k=new Array();g=new Array();p=0;c=true};this.debugObject=function(x){console.log("OBJECT   : "+x.name);console.log("VERTEXES : "+x.vertices.length/3);console.log("NORMALS  : "+x.normals.length/3);console.log("UV       : "+x.UVS.length/2);console.log("INDEXES  : "+x.indexes.length)}}OMEGA.Omega3D.parsers=OMEGA.Omega3D.parsers||{};OMEGA.Omega3D.parsers.OBJParser=OBJParser;function ColladaParser(){var b=new Array(),d=new Array(),c=new Array(),a=new Array();this.GetVertices=function(){return b};this.GetNormals=function(){return d};this.GetUVS=function(){return c};this.GetIndexes=function(){return a};this.parseFile=function(f){var e=new XMLHttpRequest();e.open("GET",f,false);e.send();var g=e.responseText;if(window.DOMParser){parser=new DOMParser();xmlDoc=parser.parseFromString(g,"text/xml")}else{xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async=false;xmlDoc.loadXML(g)}return xmlDoc};this.parseScene=function(f){var l=this.parseFile(f);var h=l.getElementsByTagName("geometry");var g=l.getElementsByTagName("visual_scene");var k=new Array();var j=new Array();for(var e=0;e<h.length;e++){console.log(h[e]);var m=this.parseToObject3DFromXMLNode(h[e]);k[m.id]=m}console.log(g[0]);return{objects:k,matrixes:j}};this.parseToObject3DFromXMLNode=function(o){var h=o.attributes[0].value;var g=o.attributes[1].value;var v=o.getElementsByTagName("mesh")[0];var f=v.getElementsByTagName("source");var u=new Array();for(var p=0;p<v.childNodes.length;p++){if(v.childNodes[p].id!=undefined){u.push(v.childNodes[p])}}var k=u[u.length-1];var e=[b,d,c];for(var p=0;p<f.length;p++){var t=f[0].childNodes[1].childNodes[0].nodeValue.split(" ");console.log(t);var s=new Array();for(var n=0;n<t.length;n++){e[p].push(parseFloat(t[n]))}}a=k.getElementsByTagName("p")[0].childNodes[0].nodeValue;var q=a.split(" ");if(q[0]==""){console.log("shifting");q.shift();console.log(q[0])}a=new Array();for(var n=0;n<q.length;n+=2){a.push(parseInt(q[n]))}var m=new Omega3D.Geometry();m.SetVertices(e[0]);m.SetNormals(e[1]);m.SetUVS(e[2]);m.SetIndexes(a);var r=new Omega3D.Mesh(m);var l=new Omega3D.Object3D(r,new Omega3D.BasicMaterial([],scene,[0.2,0.2,0.2]));l.name=g;l.id=h;return l}}OMEGA.Omega3D.parsers=OMEGA.Omega3D.parsers||{};OMEGA.Omega3D.parsers.ColladaParser=ColladaParser;function WebGLRenderer(j){var g=null;var f=null;var h=null;var e=null;var k=null;this.passes=new Array();this.materials=null;this.objects=null;this.list=null;var a=j||false;this.autoClear=true;this.CLEAR_COLOR_BIT=true;this.CLEAR_DEPTH_BIT=true;this.CLEAR_STENCIL_BIT=true;__construct=function(){g=mat4.create();this.materials=new Array();this.objects=new Array();this.list=new Array();window.requestAnimFrame=(function(){return(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(l){window.setTimeout(l,1000/60)})})()}();this.clear=function(m){var o=this.CLEAR_COLOR_BIT?OMEGA.Omega3D.GL.COLOR_BUFFER_BIT:0;var n=this.CLEAR_DEPTH_BIT?OMEGA.Omega3D.GL.DEPTH_BUFFER_BIT:0;var l=this.CLEAR_STENCIL_BIT?OMEGA.Omega3D.GL.STENCIL_BUFFER_BIT:0;var m=m||{r:0,g:0,b:0,a:1};OMEGA.Omega3D.GL.clearColor(m.r,m.g,m.b,m.a);OMEGA.Omega3D.GL.clear(o|n|l)};this.viewPort=function(o,l,q,m,n){var p=o.getGL();p.viewport(l||0,q||0,m||p.viewPortWidth,n||p.viewPortHeight)};this.SetStencilParams=function(p,o,m,l,n){var q=p.getGL();if(o){q.stencilFunc(o[0],o[1],o[2])}if(m){q.stencilOp(m[0],m[1],m[2])}q.stencilMask(l);q.depthMask(n)};this.addRenderPass=function(l){this.passes.push(l);if(!h){h=l;e=h}else{l.prev=e;e.next=l;e=l}};this.SetRenderChain=function(l){k=l};this.render=function(){if(OMEGA.Omega3D.AVAILABLE&&k!=undefined){k.Render()}};this.renderSceneToStencil=function(n,m){m.update();this.materials=n.materials;this.objects=n.objects;this.list=n.list;var o=n.getGL();o.enable(o.STENCIL_TEST);var l=n.getColor();o.disable(o.STENCIL_TEST)};var d=new Omega3D.Scene();var c=new Omega3D.Mesh(new Omega3D.Geometry.SquareGeometry(1,1));var i=new Omega3D.Material(null,[]);var b=new Omega3D.Object3D(c,i);d.addChild(b);this.renderFilter=function(m,l,n){d.update();b.GetMaterial().SetShader(m);b.GetMaterial().SetTextures([l]);d.getGL().bindFramebuffer(d.getGL().FRAMEBUFFER,n.GetFrameBuffer());this.viewPort(d,0,0,n.GetFrameBuffer().width,n.GetFrameBuffer().height);this.renderScene(d);d.getGL().bindFramebuffer(d.getGL().FRAMEBUFFER,null)};this.renderScene=function(p,o){if(a){OMEGA.Omega3D.Log("Renderer.Render START")}var q=p.getGL();this.clear(p.getColor());var n=null,l=null;for(var m=0;m<p.children.length;m++){n=p.children[m];if(!n.mayRender){continue}n.Update(p.getGL(),o);this.RenderObject(p,o,n);n.LateUpdate(p.getGL(),o)}if(a){OMEGA.Omega3D.Log("Renderer.Render END")}};this.RenderObject=function(v,x,y){var s=v.getGL();if(y.material!=null){if(y.material.hasAtlas){y.material.atlas.Update(v)}y.material.Enable();program=y.material.GetShader().GetProgram();if(y.material.GetTextures()!=null){if(y.material.hasAtlas){if(y.GetMesh().GetGeometry()!=null){y.GetMesh().GetGeometry().UpdateAtlasUV(y.material.GetCurrentAtlasFrame(),10,10)}}var B=y.material.GetTextures();var n=B.length;for(var q=0;q<n;q++){if(B[q].needsUpdate){B[q].Update()}}}if(y.GetMesh()!=null){y.GetMesh().Update()}if(program.uProjectionMatrix&&x!=null){s.uniformMatrix4fv(program.uProjectionMatrix,false,x.GetProjectionMatrix())}if(program.uViewMatrix&&x!=null){s.uniformMatrix4fv(program.uViewMatrix,false,x.GetMatrix())}if(program.uInvViewMatrix&&x!=null){s.uniformMatrix4fv(program.uInvViewMatrix,false,x.GetInverseMatrix())}if(program.uCamPos&&x!=null){s.uniform3fv(program.uCamPos,x.GetPosition())}for(var z in y.material.uniforms){s.uniform3fv(program[z],y.material.uniforms[z].value.apply(y.material,null))}for(var z in y.material.custom_uniforms){var A=y.material.custom_uniforms[z];if(A.type=="int"){s.uniform1i(program[z],A.value)}else{if(A.type=="float"){s.uniform1f(program[z],A.value)}else{if(A.type=="mat4"){s.uniformMatrix4fv(program[z],false,A.value)}else{if(A.type=="mat3"){s.uniformMatrix3fv(program[z],false,A.value)}else{if(A.type=="vec4"){s.uniform4fv(program[z],A.value)}else{if(A.type=="vec3"){s.uniform3fv(program[z],A.value)}else{if(A.type=="vec2"){s.uniform2fv(program[z],A.value)}}}}}}}}for(var z in y.material.custom_attribs){s.enableVertexAttribArray(program[z]);s.bindBuffer(s.ARRAY_BUFFER,y.material.custom_attribs[z].value);s.vertexAttribPointer(program[z],y.material.custom_attribs[z].value.itemSize,s.FLOAT,false,0,0)}if(v.getLights().length>0&&v.lightsON&&program!=null){var p=v.getLights();for(var w in p){for(var z in p[w].uniforms){if(p[w].uniforms[z].type=="vec3"){s.uniform3fv(program[z],p[w].uniforms[z].value.apply(p[w],null))}else{if(p[w].uniforms[z].type=="float"){s.uniform1f(program[z],p[w].uniforms[z].value.apply(p[w],null))}}}}}if(v.hasFog){s.uniform3fv(program.uFogColor,[v.getColor().r,v.getColor().g,v.getColor().b]);s.uniform2fv(program.uFogDist,[v.fogStart,v.fogEnd])}s.uniformMatrix4fv(program.uModelMatrix,false,y.GetMatrix());var C=mat4.create();var m=mat3.create();if(x!=null){mat4.multiply(C,x.GetMatrix(),y.GetMatrix());mat3.fromMat4(m,C);mat3.invert(m,m);mat3.transpose(m,m)}s.uniformMatrix3fv(program.uNormalMatrix,false,m);var o=68;if(y.GetMesh()!=null){s.bindBuffer(s.ARRAY_BUFFER,y.GetMesh().GetCombinedBuffer());if(program.aVertexPos!=-1){s.enableVertexAttribArray(program.aVertexPos);s.vertexAttribPointer(program.aVertexPos,3,s.FLOAT,false,o,0)}if(program.aVertexNormal!=-1){s.enableVertexAttribArray(program.aVertexNormal);s.vertexAttribPointer(program.aVertexNormal,3,s.FLOAT,false,o,12)}if(program.aTextureCoord!=-1){s.enableVertexAttribArray(program.aTextureCoord);s.vertexAttribPointer(program.aTextureCoord,2,s.FLOAT,false,o,24)}if(program.aVertexTangent!=-1){s.enableVertexAttribArray(program.aVertexTangent);s.vertexAttribPointer(program.aVertexTangent,3,s.FLOAT,false,o,32)}if(program.aVertexBitangent!=-1){s.enableVertexAttribArray(program.aVertexBitangent);s.vertexAttribPointer(program.aVertexBitangent,3,s.FLOAT,false,o,44)}if(program.aVertexColor!=-1){s.enableVertexAttribArray(program.aVertexColor);s.vertexAttribPointer(program.aVertexColor,3,s.FLOAT,false,o,56)}if(program.aPickingColor!=-1&&y.GetMesh().GetColorPickingBuffer()!=undefined){s.enableVertexAttribArray(program.aPickingColor);s.bindBuffer(s.ARRAY_BUFFER,y.GetMesh().GetColorPickingBuffer());s.vertexAttribPointer(program.aPickingColor,y.GetMesh().GetColorPickingBuffer().itemSize,s.FLOAT,false,0,0)}s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,y.GetMesh().GetIndexBuffer());if(y.drawType==OMEGA.Omega3D.Object3D.DEFAULT){s.drawElements(s.TRIANGLES,y.GetMesh().GetIndexBuffer().numItems,s.UNSIGNED_SHORT,y.GetMesh().GetIndexBuffer())}else{if(y.drawType==OMEGA.Omega3D.Object3D.WIREFRAME){s.drawElements(s.LINES,y.GetMesh().GetIndexBuffer().numItems,s.UNSIGNED_SHORT,y.GetMesh().GetIndexBuffer())}else{if(y.drawType==OMEGA.Omega3D.Object3D.POINTS){s.drawArrays(s.POINTS,0,y.GetMesh().GetGeometry().GetVertices().length/3)}else{if(y.drawType==OMEGA.Omega3D.Object3D.TRIANGLES){s.drawArrays(s.TRIANGLES,0,y.GetMesh().GetGeometry().GetVertices().length/3)}}}}if(program.aVertexPos!=-1){s.disableVertexAttribArray(program.aVertexPos)}if(program.aTextureCoord!=-1){s.disableVertexAttribArray(program.aTextureCoord)}if(program.aVertexNormal!=-1){s.disableVertexAttribArray(program.aVertexNormal)}if(program.aVertexTangent!=-1){s.disableVertexAttribArray(program.aVertexTangent)}if(program.aVertexBitangent!=-1){s.disableVertexAttribArray(program.aVertexBitangent)}}y.material.Disable();s=null}for(var r=0;r<y.children.length;r++){this.RenderObject(v,x,y.children[r])}}}OMEGA.Omega3D.WebGLRenderer=WebGLRenderer;function Pass(){this.next=null;this.prev=null;this.render=function(){}}OMEGA.Omega3D.Pass=Pass;function RenderPass(c,d,b,a){Pass.apply(this);this.renderer=c;this.scene=d;this.cam=b;this.gl=d!=null?d.getGL():null;this.color=d!=null?d.getColor():null;this.AlphaBlend=a|false;this.render=function(){if(this.cam){this.cam.update()}if(this.scene){this.scene.update()}if(this.AlphaBlend){this.gl.disable(this.gl.DEPTH_TEST);this.gl.enable(this.gl.BLEND);this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)}else{this.gl.enable(this.gl.DEPTH_TEST)}this.renderer.viewPort(this.scene);this.renderer.renderScene(this.scene,this.cam);if(this.AlphaBlend){this.gl.disable(this.gl.BLEND);this.gl.enable(this.gl.DEPTH_TEST)}else{this.gl.disable(this.gl.DEPTH_TEST)}}}RenderPass.prototype=new Pass();OMEGA.Omega3D.RenderPass=RenderPass;function ProxyPass(c,b,a){Pass.apply(this);this.next=null;this.prev=null;this.target=c;this.proxy=b;this.args=a||null;this.render=function(){this.proxy.apply(this.target,this.args)}}RenderPass.prototype=new Pass();OMEGA.Omega3D.ProxyPass=ProxyPass;function PostProcessingPass(d,b,c,a){RenderPass.apply(this,[d,b.parentScene,null]);this.out_texture=a;this.in_shader=c;this.screen_quad=b;this.render=function(){this.screen_quad.parentScene.update();this.screen_quad.GetMaterial().SetShader(this.in_shader);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.out_texture.GetFrameBuffer());this.renderer.viewPort(this.scene,0,0,this.out_texture.GetFrameBuffer().width,this.out_texture.GetFrameBuffer().height);this.renderer.renderScene(this.scene,null);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);this.out_texture.Disable();this.screen_quad.GetMaterial().SetTextures([this.out_texture])}}PostProcessingPass.prototype=new RenderPass();OMEGA.Omega3D.PostProcessingPass=PostProcessingPass;function ShadowMapPass(d,e,b,c,a){RenderPass.apply(this,[d,e,b]);this.type=a||OMEGA.Omega3D.ShadowMapPass.PCF;this.texture=c;this.render=function(){this.cam.update();this.gl.frontFace(this.gl.CW);this.gl.enable(this.gl.CULL_FACE);this.gl.cullFace(this.gl.FRONT);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.texture.GetFrameBuffer());if(this.type==OMEGA.Omega3D.ShadowType.PCF){this.gl.colorMask(false,false,false,false)}this.gl.enable(this.gl.DEPTH_TEST);this.renderer.viewPort(this.scene.shadowScene,0,0,this.texture.GetFrameBuffer().width,this.texture.GetFrameBuffer().height);this.renderer.renderScene(this.scene.shadowScene,this.cam);this.gl.disable(this.gl.DEPTH_TEST);this.gl.cullFace(this.gl.BACK);this.gl.disable(this.gl.CULL_FACE);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);if(this.type==OMEGA.Omega3D.ShadowType.PCF){this.gl.colorMask(true,true,true,true)}}}ShadowMapPass.prototype=new RenderPass();OMEGA.Omega3D.ShadowMapPass=ShadowMapPass;function RenderToTexturePass(c,d,a,b){RenderPass.apply(this,[c,d,a]);this.texture=b;this.render=function(){if(this.cam!=null){this.cam.update()}if(this.scene!=null){this.scene.update()}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.texture.GetFrameBuffer());this.gl.enable(this.gl.DEPTH_TEST);this.renderer.viewPort(this.scene,0,0,this.texture.GetFrameBuffer().width,this.texture.GetFrameBuffer().height);this.renderer.renderScene(this.scene,this.cam);this.gl.disable(this.gl.DEPTH_TEST);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}}RenderToTexturePass.prototype=new RenderPass();OMEGA.Omega3D.RenderToTexturePass=RenderToTexturePass;function FilterPass(d,c,a,b){RenderPass.apply(this,[d,null,null]);this.in_texture=a;this.out_texture=b;this.shader=c;this.render=function(){this.renderer.renderFilter(this.shader,this.in_texture,this.out_texture)}}FilterPass.prototype=new RenderPass();OMEGA.Omega3D.FilterPass=FilterPass;function ColorPickPass(e,f,d){RenderPass.apply(this,[e,f,d]);this.texture=new Omega3D.FrameBufferTexture();this.pickingShader=new OMEGA.Omega3D.Shaders.ColorPicking();this.buffer=new Uint8Array(4);var a={x:0,y:0};var b={};f.selectedObject=null;this.render=function(){this.cam.update();this.scene.update();b.sceneColor=f.getColor();f.setColor(1,1,1);f.lightsON=false;this.swapShadersPicking(f);var g=this.texture.GetFrameBuffer().width/c.width;var i=this.texture.GetFrameBuffer().height/c.height;this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.texture.GetFrameBuffer());this.gl.enable(this.gl.DEPTH_TEST);this.renderer.viewPort(this.scene,0,0,this.texture.GetFrameBuffer().width,this.texture.GetFrameBuffer().height);this.renderer.renderScene(this.scene,this.cam);this.gl.disable(this.gl.DEPTH_TEST);this.gl.readPixels(Math.floor(g*a.x),this.texture.GetFrameBuffer().height-Math.floor(i*a.y),1,1,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.buffer);var h=this.buffer[0]+this.buffer[1]+this.buffer[2];f.selectedObject=this.searchChild(f,h);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);this.swapShadersNotPicking(f);f.lightsON=true;f.setColor(b.sceneColor.r,b.sceneColor.g,b.sceneColor.b);b={}};this.searchChild=function(h,k){var j=null;for(var g=0;g<h.children.length;g++){if(parseFloat(h.children[g].id)==k){j=h.children[g]}else{if(h.children[g].children.length>0){j=this.searchChild(h.children[g],k)}}if(j!=null){break}}return j};this.swapShadersPicking=function(h){var j=null;for(var g=0;g<h.children.length;g++){j=h.children[g];if(j.GetMaterial()!=null){if(j.GetMaterial().GetShader()!=this.pickingShader){b[j.id]=j.GetMaterial().GetShader()}j.GetMaterial().SetShader(this.pickingShader)}if(h.children[g].children.length>0){this.swapShadersPicking(h.children[g])}}};this.swapShadersNotPicking=function(h){var j=null;for(var g=0;g<h.children.length;g++){j=h.children[g];if(j.GetMaterial()!=null&&b[j.id]!=null){j.GetMaterial().SetShader(b[j.id])}if(h.children[g].children.length>0){this.swapShadersNotPicking(h.children[g])}}};var c=document.getElementById("omega");document.onmousemove=function(g){var h=c.getBoundingClientRect();a.x=g.clientX-h.left;a.y=g.clientY-h.top}}ColorPickPass.prototype=new Pass();OMEGA.Omega3D.ColorPickPass=ColorPickPass;function DepthPass(c,d,a,b){RenderPass.apply(this,[c,d,a]);this.texture=b;this.fogSave=false;this.render=function(){if(this.cam){this.cam.update()}if(this.scene){this.scene.update();this.fogSave=this.scene.hasFog;this.scene.hasFog=false}this.gl.frontFace(this.gl.CW);this.gl.enable(this.gl.CULL_FACE);this.gl.cullFace(this.gl.FRONT);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.texture.GetFrameBuffer());this.gl.enable(this.gl.DEPTH_TEST);this.renderer.viewPort(this.scene,0,0,this.texture.GetFrameBuffer().width,this.texture.GetFrameBuffer().height);this.renderer.renderScene(this.scene,this.cam);this.gl.disable(this.gl.DEPTH_TEST);this.gl.cullFace(this.gl.BACK);this.gl.disable(this.gl.CULL_FACE);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);if(this.scene){this.scene.hasFog=this.fogSave}}}DepthPass.prototype=new RenderPass();OMEGA.Omega3D.DepthPass=DepthPass;function DynamicCubeMapPass(b,d,a,c){RenderPass.apply(this,[b,d,null]);this.object=a;this.texture=a.GetMaterial().GetTextures()[0];this.render=function(){a.mayRender=false;this.texture.UpdateFaces(c,b,d);a.mayRender=true}}DynamicCubeMapPass.prototype=new RenderPass();OMEGA.Omega3D.DynamicCubeMapPass=DynamicCubeMapPass;function StencilPass(e,f,c,b){RenderPass.apply(this,[e,f,c]);var d=b.stencilData;var a=b.contentData;this.render=function(){this.cam.update();this.scene.update();this.gl.enable(this.gl.STENCIL_TEST);this.renderer.viewPort(this.scene);this.renderer.SetStencilParams(this.scene,d.stencilFuncData,d.stencilOpData,d.stencilMask,d.depthMask);this.renderer.renderScene(this.scene,this.cam);this.renderer.SetStencilParams(this.scene,a.stencilFuncData,a.stencilOpData,a.stencilMask,a.depthMask)}}StencilPass.prototype=new RenderPass();OMEGA.Omega3D.StencilPass=StencilPass;function RenderChain(){var c=[];var b=null,a=null,d=null;this.AddRenderPass=function(e){c.push(e);if(!b){b=e;a=b}else{e.prev=a;a.next=e;a=e}};this.Render=function(){d=b;while(d){d.render();d=d.next}}}OMEGA.Omega3D.RenderChain=RenderChain;function KeyListener(){this.active=true;this.currentlyPressedKeys=[];this.HandleKeyDown=function(a){if(!this.active){return}this.currentlyPressedKeys[a.keyCode]=a.keyCode};this.HandleKeyUp=function(a){if(!this.active){return}delete this.currentlyPressedKeys[a.keyCode]};this.Enable=function(){if(this.active){return}this.currentlyPressedKeys=[];this.active=true};this.Disable=function(){if(!this.active){return}this.currentlyPressedKeys=[];this.active=false}}OMEGA.listeners=OMEGA.listeners||{};OMEGA.listeners.KeyListener=KeyListener;
0
